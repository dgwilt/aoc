#!/usr/bin/env python3 
from itertools import product
from collections import defaultdict
from sys import argv
from aoc import AocDay

class AocDay7(AocDay):

    def run_silver(self,data):
        grid = data.splitlines()
        beams = set([grid[0].index("S")])
        splitters = set((x,y) for x,y in product(range(len(grid[0])),range(len(grid))) if grid[y][x] == "^")
        splits = 0
        for y in range(1,len(grid)):
            nextbeams = set()
            for bx in beams:
                if (bx,y) in splitters:
                    splits += 1
                    nextbeams.add(bx-1)
                    nextbeams.add(bx+1)
                else:
                    nextbeams.add(bx)
            beams = nextbeams
        return splits
        
    def run_gold(self,data):
        grid = data.splitlines()
        beams = {grid[0].index("S"):1}
        splitters = set((x,y) for x,y in product(range(len(grid[0])),range(len(grid))) if grid[y][x] == "^")
        splits = defaultdict(int)
        for y in range(1,len(grid)):
            nextbeams = defaultdict(int)
            for bx,count in beams.items():
                if (bx,y) in splitters:
                    splits[y] += count
                    nextbeams[bx-1] += count
                    nextbeams[bx+1] += count
                else:
                    nextbeams[bx] += count
            beams = nextbeams

        timelines = {0:1}
        for y in range(1,len(grid)):
            timelines[y] = (2 * splits[y]) + (timelines[y-1] - splits[y])
        return timelines[len(grid)-1]

if __name__ == "__main__":

    silver_tests = [""".......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............""",""""""]

    gold_tests = ["""""",""""""]

    data = """......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^...^.^...................................................................
.............................................................................................................................................
..................................................................^.^.....^..................................................................
.............................................................................................................................................
.................................................................^.^...^.^.^.................................................................
.............................................................................................................................................
................................................................^...^.^.^.^.^................................................................
.............................................................................................................................................
...............................................................^.^...^.....^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^...^.^.^..............................................................
.............................................................................................................................................
.............................................................^...^.^...^.......^.............................................................
.............................................................................................................................................
............................................................^.^.^.^.^.^...^.^.^.^............................................................
.............................................................................................................................................
...........................................................^.^.^.^.^.^...^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^.......^...^.^.^.^.^.^.^..........................................................
.............................................................................................................................................
.........................................................^...^...^.....^...^.......^.........................................................
.............................................................................................................................................
........................................................^...^.^.^.^.^...^.^.^.^.^...^........................................................
.............................................................................................................................................
.......................................................^.....^.....^.^.....^.^.^.^...^.......................................................
.............................................................................................................................................
......................................................^.^.^.....^.^.^...^...^...^...^.^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.^...^.^.....^.^.^.^.^.^.^.^.....................................................
.............................................................................................................................................
....................................................^.^.^.^.....^.^.^.....^.^.^...^.^.^.^....................................................
.............................................................................................................................................
...................................................^...^...^...^.^...^.^.^.^.^.^.^.^...^.^...................................................
.............................................................................................................................................
..................................................^.^...^.^.^.^...^.^.^...^...^.^...^.^...^..................................................
.............................................................................................................................................
.................................................^.^.^.^.^.^.....^...^.^.^.^.^.^...^...^.^.^.................................................
.............................................................................................................................................
................................................^.^.^.....^.........^.^...^.^.....^.^.^.^.^.^................................................
.............................................................................................................................................
...............................................^...^.^.^.^.^.^...^...^...^.^.^.^.^.....^.^...^...............................................
.............................................................................................................................................
..............................................^.^.^.^...^.^...^.....^.^...^.^...^...^.....^.^.^..............................................
.............................................................................................................................................
.............................................^.^...^...^.^.^.^.^.^...^...^.^...^.....^...^.^.^.^.............................................
.............................................................................................................................................
............................................^.^...^.....^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^...^.^.^.^.^.^.....^...........^.^...^...^.^.^.^.....^...........................................
.............................................................................................................................................
..........................................^.^.....^.^.....^.....^.....^...^.^...^...^.^.^.^.^...^.^..........................................
.............................................................................................................................................
.........................................^.....^.^.^...^.^.^.^.^.^.^.....^...^.^.^...^.^.^.^.^.^.^.^.........................................
.............................................................................................................................................
........................................^...^.^.^...^.^.^.^.^.....^.^.^.^.^...^...^.......^.^.^.^...^........................................
.............................................................................................................................................
.......................................^...^.^.^...^...^.^...^.^.^.^...^.....^.....^...^.^.^.^.^.^.^.^.......................................
.............................................................................................................................................
......................................^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^.^.^.^.^...^.^.^.^...^.^.^......................................
.............................................................................................................................................
.....................................^.^.^...^.^.^.^.^.^.^.^...^.^...^.^...^.^.....^...^.....^.^...^.^.^.....................................
.............................................................................................................................................
....................................^.^.^.^.^.^.^.......^...^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^.^....................................
.............................................................................................................................................
...................................^.^.....^...^...^.^.^.^.^...^.^.^.....^.^...^...^.^.........^...^.^.^.^...................................
.............................................................................................................................................
..................................^.^.^.....^.^.^.........^.^.^.^...^.......^...^.^.^.^.^.......^.^.^...^.^..................................
.............................................................................................................................................
.................................^.....^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.^.....^.^...^.^.^.^.^.^.^.^.^.^...^.................................
.............................................................................................................................................
................................^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^................................
.............................................................................................................................................
...............................^...^.^.....^.........^...^.....^.^.^...^.^.....^.....^.^.^.^.^...^.^.^.^.^.^.^...............................
.............................................................................................................................................
..............................^...^.....^.^.^.^...^.^.^.^.....^.^.^...^...^...^...^.....^.^.^.^.^.^.^.^.^.....^..............................
.............................................................................................................................................
.............................^.^...^.^...^.^.^.^.^.^.^.^...^.....^.^...^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.^...^.^.............................
.............................................................................................................................................
............................^...^.^.^...^.^.^.^.^.^.^.^...^.^...^.^.^...^.^...^.^.^.^.^.^.^.^.^.......^...^.^.^.^............................
.............................................................................................................................................
...........................^.....^...^...^.^.^.^.^.^.^...^.^.........^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.....^.^.^.^...........................
.............................................................................................................................................
..........................^.^.^...^.^.^.^.^.....^...^.^.^...^...^.^.^.^...^.^.^...^.^.^.^.....^.^.....^...^.^.^.^.^..........................
.............................................................................................................................................
.........................^.^.........^.^.....^.^.....^.....^...^.^...^.^...^.^.....^.^.^...^.^.^...^.^...^.^.^...^.^.........................
.............................................................................................................................................
........................^.^.^...^.^.^.^.....^.^.^.....^...^.^.^...^.^.^.....^.^.^...^.^.^.^.....^.^.^...^.^.^.^.^...^........................
.............................................................................................................................................
.......................^...^.^...^.^.^.^.......^.^.^.....^.^.^.^.^.....^.^.^.^.....^.^.^.^.^...^...^.^.^...^...^.^.^.^.......................
.............................................................................................................................................
......................^.^...^.^...^.^.^.^...^...^...^.^.^.^...^.^.^...^...^...^.^.^.^.......^.^...^...^.^...^.^...^.^.^......................
.............................................................................................................................................
.....................^.^.^.^.^.^...^.^.^.^.^.^.^.....^.^...^.^.^.^...^.^.^.^...^.^.^...^.^...^.........^.....^.^...^.^.^.....................
.............................................................................................................................................
....................^.^.^.^...^...^.^...^...^...^.^...^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.....^...^...^...^...^.^.^.......^....................
.............................................................................................................................................
...................^...^.^.^.^.^.^.....^.^...^...^.^.^.........^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.......^.^.^.......^...................
.............................................................................................................................................
..................^.......^...^...^.^.^.^...^.........^...^.^.^.....^.......^...^...^.....^.^.^.^.^.^.^.^...^.^...^.^.^.^.^..................
.............................................................................................................................................
.................^.^.^.^.^.^.^.^.^.....^.^...^.^.^.^...^.^.^...^.^.^...^...^.^...^.^.^.^.^.^.....^.^.^.^.^...^.....^.^...^.^.................
.............................................................................................................................................
................^.^.^.^.^.^.^...^...^.^.^.^...^.....^.^.^...^.^.^.....^.^.^.....^.^...^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^...^................
.............................................................................................................................................
...............^.^.....^.^.^.^.^.......^.^.^.^.^.^.^...^.^.^.......^.^...^.^...^.^.^.^...^...^.^.^.^...^.^.^...^.^.^.^.....^.^...............
.............................................................................................................................................
..............^...^...^.^.^.^.^.....^.^...^.^.^.^.^.^.^.^...^.....^...^.^.^.....^.^.^.^.....^.^...^.^.^.^.^.^.^.....^.^...^.^.^..............
.............................................................................................................................................
.............^.^.....^.^.^.^.^...^.....^.^.....^.^.^.^...^.^.........^.....^.....^.^...^...^.^.^...^.^.....^.^.^...^.^.^.^.^.^.^.............
.............................................................................................................................................
............^.^...^...^.^.........^.^.^...^.^.^.^.^.^.....^.^...^.^.........^.^...^.....^.^.....^...^.^.^.^.^.^.^.....^.^...^.^.^............
.............................................................................................................................................
...........^...^...^...^.^.^...^...^...^.^.^.^...^.....^...^.^.^.....^.....^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.......^.^...........
.............................................................................................................................................
..........^...^.^...^...^.^.....^...^.^...^.^.^.....^.^.^.^...^.^...^.^.^.^...^...^...^...^.^.^.^.^.^.^...^.^.^.^.....^...^.^.^.^.^..........
.............................................................................................................................................
.........^.^...^.^.^.^...^...^...........^.^...^...^.^...^.^.^.^...^.^.^.^.....^.^.....^.^.^.^...^.^.^.....^...^.^.^.^.^.^.^.^.^...^.........
.............................................................................................................................................
........^...^.^...^.^...^...^.^.^.^.^.^...^.^.....^.^.^.....^.^...^.^.^.....^.....^.^.^.^.^...^.....^...^...^.^.^...^...^...^...^...^........
.............................................................................................................................................
.......^.^.....^...^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.......^.^.^.^.^.^.........^...^.^.^.^.........^.^.^.^.^.....^.^.^.^.^.....^.^.^.......
.............................................................................................................................................
......^...^.^.^...^.^.^.^...^.^...^...^.^.^.....^.^.^...^.....^.^.^...^.^.^.....^.^.^.^.^.^.^.^.....^.^.......^.^.^.^.^.^.^.^...^.^...^......
.............................................................................................................................................
.....^.^.......^.^.^.^.^.^...^.^.^...........^.^...^...^.^...^.......^.^.....^...^...^.^.^.....^.^...^...^.^.....^.^.^.^.^.^.^...^.....^.....
.............................................................................................................................................
....^.^.^.^.^.^...^.^...^...........^.....^...^...^.^.^.^.^.^...^.....^.^...^.^.^...^.^...^...^.^.^...^.^...^.^.^...^.^...^...^.^.^.^...^....
.............................................................................................................................................
...^.^...^.^.^.^.^.^.^...^.^.^.^...^.^...^.....^.^.^.^...^.^.....^.^.^.^.^...^.^...^.....^...^...^.....^.^...^.^.........^.^.^...^.^.^.^.^...
.............................................................................................................................................
..^.^.^.....^.^.^.^.^...^.^.^.....^.^.^.^.^.^.^...^.....^.^.....^.^.....^.^...^.......^.^...^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^..
.............................................................................................................................................
.^.^.^.........^.^.^.....^.^.^.^.^...^.^...^...^.^.^.^.....^...^.^...^.^.^...^.^.....^.....^...^...^...^.^.....^...^.^...^.^.....^.^.^.^.^.^.
............................................................................................................................................."""

    answer = AocDay7(data,silver_tests,gold_tests,argv)

    print(answer)
