#!/usr/bin/env python3 
from itertools import product
from collections import defaultdict
from sys import argv
from aoc import AocDay
from heapq import heappush,heappop
from math import inf

class AocDay16(AocDay):

    VISUALIZE = False

    def parser(self,data):
        grid = data.splitlines()
        xdim,ydim = len(grid[0]),len(grid)

        walls = set()
        for x,y in product(range(xdim),range(ydim)):
            pos = (x,y)
            if (cell := grid[y][x]) == "E":
                target = pos
            elif cell == "S":
                start = pos
            elif cell == "#":
                walls.add(pos)
        return walls, start, target, xdim, ydim
    
    def dijkstra(todo,cost,pos,dir,walls,path,turns):
        for newdir in turns[dir]:
            if (nxt := (pos[0]+newdir[0], pos[1]+newdir[1])) in walls: continue
            heappush(todo,(cost + (1 if dir == newdir else 1001),nxt,newdir,path + [nxt]))

    def run_silver(self,data):
        N,S,W,E = (0,-1),(0,1),(-1,0),(1,0)
        turns = {N:(N,W,E),S:(S,W,E),E:(E,N,S),W:(W,N,S)}
        walls, start, target, _, _ = self.parser(data)
        
        todo = []
        heappush(todo, (0,start,E,[]))
        visited = set()

        while todo:
            cost,pos,dir,_ = heappop(todo)

            ############ Silver Termination Logic
            if pos == target: return cost
            if pos in visited: continue
            visited.add(pos)
            ############

            AocDay16.dijkstra(todo,cost,pos,dir,walls,[],turns)

    def pathtiles(mincosts,target,paths,xdim,ydim):
        N,S,W,E = (0,-1),(0,1),(-1,0),(1,0)
        mincost = inf
        for d in (N,S,W,E):
            if (cost := mincosts[(target,d)]) < mincost:
                mincost = cost
                result = len(bestpath := set(p for path in paths[(target,d)] for p in path))

        if AocDay16.VISUALIZE:
            for y in range(ydim):
                for x in range(xdim):
                    print("O" if (x,y) in bestpath else " ", end="")
                print()

        return result
    
    def run_gold(self,data):
        N,S,W,E = (0,-1),(0,1),(-1,0),(1,0)
        turns = {N:(N,W,E),S:(S,W,E),E:(E,N,S),W:(W,N,S)}
        walls, start, target, xdim, ydim = self.parser(data)        
        todo,paths,mincosts = [],{},defaultdict(lambda: inf)
        heappush(todo, (0,start,E,[start]))
        
        while todo:
            cost,pos,dir,path = heappop(todo)

            ############ Gold Termination Logic
            vec = (pos,dir)
            if cost < mincosts[vec]:
                mincosts[vec] = cost
                if pos == target: paths[vec] = [path]
            elif cost == mincosts[vec]:
                if pos == target: paths[vec].append(path)
            else: continue
            ############

            AocDay16.dijkstra(todo,cost,pos,dir,walls,path,turns)

        return AocDay16.pathtiles(mincosts,target,paths,xdim,ydim)

if __name__ == "__main__":

    silver_tests = ["""###############
#.......#....E#
#.#.###.#.###.#
#.....#.#...#.#
#.###.#####.#.#
#.#.#.......#.#
#.#.#####.###.#
#...........#.#
###.#.#####.#.#
#...#.....#.#.#
#.#.#.###.#.#.#
#.....#...#.#.#
#.###.#.#.#.#.#
#S..#.....#...#
###############
""","""#################
#...#...#...#..E#
#.#.#.#.#.#.#.#.#
#.#.#.#...#...#.#
#.#.#.#.###.#.#.#
#...#.#.#.....#.#
#.#.#.#.#.#####.#
#.#...#.#.#.....#
#.#.#####.#.###.#
#.#.#.......#...#
#.#.###.#####.###
#.#.#...#.....#.#
#.#.#.#####.###.#
#.#.#.........#.#
#.#.#.#########.#
#S#.............#
#################"""]

    gold_tests = ["""""",""""""]

    data = """#############################################################################################################################################
#...#.....................#.............#...........#.....#.#.........#.............#.......#...#.........#...........#.......#.#.........#E#
#.#.#######.#############.#.#######.#####.#######.#.###.#.#.#.#.#.#####.#####.#####.###.#.###.#.#.#.#####.#######.#.###.###.#.#.#.#####.#.#.#
#.#.......#.#...........................#.....#.#.#.....#...#...#.#.....#...#.....#...#.#...#.#...#.....#.....#...#.#...#...#.#.#.#.#...#.#.#
#.#######.#.#.###.#.###.#.#.#####.#####.#####.#.#.#####.#####.#.###.#####.#.#####.###.#####.#.#########.#####.#.###.#.###.###.#.#.#.#.###.#.#
#...#.......#...#.....#.#.#...#...#...#.....#.#.#...#...#...#.#.....#.....#.#.....#.#.#...#...#.#.......#.......................#...#...#...#
###.#######.###.#######.#.#.#.#.###.###.###.#.#.###.#####.#.#.#############.#.#####.#.#.#.#.#.#.#.#######.#.#.#.#####.#.###.#.#.###.###.#####
#...#.....#...#.........................#.#.#.....#.....#.#.#.#.............#...#...#.#.#.#.....#.#.....#.#...#.#...#.#...#.#...#...#.#.....#
#.#.#.###.#.###.#.#.#####.#.#########.#.#.#.#####.#####.#.#.#.#.###########.###.#.#.#.#.#.###.###.#.#.###.#####.#.#.#.#.#.#.#####.###.#.###.#
#.#.#.#.#.#.#...#.#.#...#.#...#...#...#...#...#...#.#...#.#...#.#.......#...#...#.#.#.#...............#...#.....#.#.#...#.#.#.....#.....#...#
#.#.#.#.#.#.#.###.#.###.#.###.#.#.#.###.#.#.#.#.###.#.###.#####.#.#####.#.###.###.#.#.#.#.#.#.#.#.#.#.#.###.#####.#.#####.#.#.#####.###.#.#.#
#.#.#.#.#.#.#.#...#...#...#...#.#.#.#...#.#...#.....#.....#.....#.#.............................#...#.#.#...#.....#...#...#.....#...#...#.#.#
#.###.#.#.###.###.###.#.#######.#.#.#.#.###.#######.#########.#.###.#.#######.#.#######.###.#####.#.#.#.#.#.#.#####.#.#.#######.#.#####.#.#.#
#.#...#.#...#.#...#...#.........#...#.#.....#.....#.#.........#.#...#...........#...#.....#.#.......#.#.#.#.#.#...#.#.#...#...#...#.......#.#
#.#.###.###.#.#.#.#.#################.#.###.#.###.#.#####.#####.#.###.#########.#.###.###.#.#.#.#.###.#.###.#.#.#.#.#####.#.#.#####.#######.#
#...#.....#.#...#.#.#.....#...#.......#.......#...#...........#.#.#.........#...#.......#.#...#.#.....#...#.....#.#.#.....#.#.......#...#...#
#.#####.#.#.#####.#.#.###.#.#.#.#######.#.#####.###########.###.#.#####.###.###.#########.#####.#########.#######.#.#.#####.###.#######.#.###
#.......#.#.......#.#...#.#.#...#.#.....#...#.......#...#.......#.......#.#...#...#.....#.....#...#.....#.........#.......#.#...#.....#.#...#
#######.#.#########.#####.#.#####.#.#.#####.#.###.###.#.#.###########.###.###.###.#.###.###.#.#.#.#.#.#####.#####.#######.#.#.###.###.#.###.#
#...#...#.......#.#.......#.#.............#.#...#...#.#...#...#.....#.....#...#.....#.....#.#.#.#...#.......#.........#...#.#...#.#...#.....#
#.#.#.#.#.#####.#.#.#.#####.#.#######.###.#.#.###.#.#.#####.#.###.#.#.###.#.###.#.#######.###.#####.#########.#.#####.#.###.#.###.#.###.#####
#.#.#.#.......#...#.#.....#.#...#.....#...#.#.#...#.#...#...#.....#.#.#...#.#.....#.....#...#.#...#.....#.....#.#.....#...#.#.#...#...#.....#
#.#.#.#.#.#.#####.#.#.###.#.###.#.#####.###.###.###.#.#.#.#########.###.#.#.###.###.###.###.#.#.#.###.###.#####.#.#.#######.###.#####.###.#.#
#.#.#.....#.......#.#.........#...#...#.#...#...#...#...#...#.....#.....#.....#...#.#.#.#...#.#.#.#...#.......#.#...#.....#...#.#...#.#...#.#
#.#.###.#.#.#######.#.#######.#####.#.#.#.#.#.###.#.#.#####.#####.#######.###.#.#.#.#.#.###.#.#.#.#.###.#######.###.#.###.###.#.#.###.#.#.###
#.#.....#.#.....#.#.#.#.....#.......#.#.#.#.#.#...#.#.....#.......#.....#.#.#.#...#...#...#...#.#.#...#.#.#...#...#...#.#.....#...#...#.#...#
#.#####.#.#.###.#.#.###.###.#########.###.#.#.#.###.#####.###.#.#.#.#.###.#.#.###.###.###.#.###.#.###.#.#.#.#.###.#####.###.#.###.#.###.#.#.#
#...#.....#.#.....#.#.....#.#...#.........#.#.#...#.#...#...#.#.....#.....#.#.#...#...#.#.#.#...#...#.#...#.#.....#.........#.....#.......#.#
#.#.#.#.#.#.###.###.#.#####.#.#.###########.#.###.#.#.#.###.#.#.###########.#.#.###.###.#.###.#####.#####.#.#.#########.#################.#.#
#.#...#.......#.#...#.#.....#.#.#.....#.....#...#.#...#.#...#.#.#.....#.....#.#...#...#.#...#.#...#.....#.#.#.#...#...#.....#...........#...#
#.#.###.#.#.#.#.#.###.#.#.###.#.#.###.#.#######.#.#####.#.###.#.###.#.#.#.#.#.###.###.#.###.#.#.#.###.###.#.###.#.#.#.#####.#.#########.#.#.#
#...#...#.#...#.#.......#.#...#...#.#.#...#.....#.....#.#.#...#.....#.#.#.#.#...#...#...#.......#.#.#.....#.#...#...#...#.#.......#.....#.#.#
###.#.#.###.#############.#.#######.#.###.###.#.#####.###.###.#.#####.###.#####.###.###.#.#.#####.#.#######.#.#########.#.#######.#.#####.###
#.#.#.#...#.......#...#...#.#.......#...#.....#.....#.....#...#...........#.....#.#.#...#.#...#...#...#.....#.#.....#...#...................#
#.#.#.#.#.#.#####.#.#.#.#.#.###.#.#.###.#########.#.#######.###.###########.#####.#.#.###.#####.###.#.#.#####.###.#.#.#.#######.###.#.###.#.#
#.#.#.#...#.....#...#.#.#.#...#.#...#.#...#.....#.#.........#.......#...#...#.......#.#.#.......#...#.#.....#...#.#.#.#.#.....#...#.#.#...#.#
#.#.#.#.###.###.#.###.#.#####.#.#.#.#.###.#.#.#.#.#######.#######.###.#.#.###.#.#####.#.#########.###.#####.###.#.#.#.#.#.###.###.#.#.#.#.#.#
#.#.#.#.#...#...#.#...#.....#.#.#.#.....#...#.#.#.......#.......#.#...#.#...#...#...#.........#...#.#.#...#...#...#.#.#.#...#.#...#...#...#.#
#.#.#.#.###.#.###.#.#.#####.#.#.#.###########.#.#######.#.#####.#.#.###.###.#.#.#.###.#######.#.###.#.###.###.#####.#.###.###.#.###.#.###.#.#
#...#.#.....#.#...#.#...#.#...#.#...........#.#.....#.#.#...#.#.#.#...#.....#.....#.......#...#...#.#...#...#.......#...#.#...#.#...#...#...#
#.###.#######.#####.###.#.#####.#####.#####.#.#####.#.#.###.#.#.#.###.#####.#######.#####.#.#####.#.###.#.###########.#.#.#.###.#.#####.#.#.#
#...#.....#...#.....#.#.....#.#.......#.....#.#...#...#.#...#.#.#...#.....#.#.........#...#.#.....#.......#.........#.#...#...#...#.......#.#
###.#.###.#.###.#####.#####.#.#.#.#####.#####.###.###.#.###.#.#.#.#######.###.#########.###.#.###########.#.#######.#####.###.#.#########.#.#
#...#...#.#...#...#.....#...#.#.#...#...#.....#...#...#...#...#.........#.....#.........#.....#.........#...#.....#.#...#...#.#.#.....#...#.#
#.#####.#.###.###.#.#.#.#.###.#.###.#.###.#####.#.#.###.#.###.#########.#######.###.#.###.#####.#######.###.#.###.#.#.#.#####.#.#.###.###.#.#
#.....#.#.#.......#.#...#.#.........#...#.......#.#...#...#...#.........#.........#.#.....#.....#.#...#...#.#...#.#.#.#.#.....#...#.#...#.#.#
#####.###.#########.###.#.###.#####.#.#.#.#.#.#######.#.#####.#.#.#.###.###.#####.#.###.#.#.#####.#.#.###.#.#.#.#.#.#.#.#.#########.###.#.#.#
#.....#...#.......#...#.#.#...#.....#.#.#.#.#.........#.....#...#.....#...#...#...#.......#.#.......#...#.#.#.#.#.#.#.#...#...........#.#.#.#
#.#####.###.#####.#####.#.#.#.#.###.###.#.#####.###########.#######.#.#.#.#.#.#####.#######.#.#####.#.###.#.#.#.#.#.#.#######.#.#####.#.###.#
#.....#.....#...#...#...#.#.#...#...#...#.#...#...#...#.....#.....#.#.#.....#...#...#.....#...#...#.#...#...#.#.#.#.#.......#.#.#.....#.#...#
#####.#######.#.#.#.#.#.#.#.#####.###.###.#.#.###.###.#.#####.###.#.#.#########.#.#.#.###.###.#.#.#####.###.#.#.#.#.#######.###.#####.#.#.###
#...#.#.......#.#.#.#.#.#...#.....#.#...#...#.#.......#.......#...#.#.#.......#.#.#.#...#...#...#.#.........#.#.#...#.....#...#.....#.#.#...#
#.#.#.#.#######.###.#.#######.#.###.#.#.#####.#################.#####.#.#####.#.#.#.###.###.###.#.#.#####.###.#.###.#.###.#.#.#.###.#.#.###.#
#.#...#.#...#.....#.#.......#...#...#.#.....#.#.........#.....#.......#.......#...#...#.#.#...#.#.#.......#...#...#.#.#...#.#.#.#...#.#.#...#
#.#####.#.#.#####.#.###.###.#.#.#.#.#.#.#####.#.#######.#.#.#####.#####.#.#####.#####.#.#.###.#.#.#.#######.#####.#.#.#.###.#.###.###.#.#.###
#.................#...#.#.....#.#.#.#.#.....#...#.....#...#.....#.#.....#.#.#...#...#.#...#.#.#.#.#...#.....#...#.#...#.....#...#.#...#.#...#
#####.#.###.#.#.###.#.#.#####.#.###.#.#####.#####.#.#.#########.#.#.#####.#.#.###.#.#.###.#.#.#.#.###.#.#####.###.#########.###.#.#.###.###.#
#...#.#.#...#.#...#.#.#.#...#.#...#.....#.#.......#.#.........#...#.#...#.#...#...#.#...#.#...#.#.#...#.....#...#...#...#...#...#.#...#...#.#
###.#.#.###.#.###.#.#.#.#.#.#####.#.###.#.#########.###.#.#########.#.###.###.#.###.#.###.#.#.###.#########.###.###.#.#.#.###.###.###.###.#.#
#...#.#.....#.#...#.#.#.#.#.....#.#.........#.....#...#...#...#.....#...#...#.#.#.#.#.#...#.#...#.............#...#.#.#.....#.....#.....#.#.#
#.###.#.#####.#.#####.#.#.###.###.#########.#.#.#.###.#####.#.#.#######.###.###.#.#.###.###.###.#############.###.#.#######.#.#.#######.#.#.#
#...#.#...#...#.........#...#...#.......#...#.#.#.#...#.....#...#...#.....#.#...#.#...#.......#.......#...#.......#.......#...#.......#.#.#.#
#.#.#.#.#.#.###########.#.#####.#######.#####.#.#.#.#.#.#########.#.#.#.###.#.###.###.#######.#######.#.#.#######.#####.#.#########.#.###.#.#
#.#.#...#.#.#...........#.#.....#.....#.#.......#.#.#.#.......#...#...#.#...#...#...#.......#.#...#...#.#.......#.#...#.#.#.......#.#.....#.#
###.###.#.#.#.#.#.###.#.#.#.#####.###.#.#.#####.#.#.#########.#.#########.#.###.###.#####.###.###.#.###.#######.###.#.###.#.#####.#.#.#####.#
#.....#...#...#.#.#...#.#.#.....#.#.#...#.#...#...#.#.....#...#...#...#...#...#.......#.#...#.....#.#.....#.....#...#.....#.#...#.#.#.......#
#.#####.#####.#.###.#.###.#####.#.#.#####.###.#.###.#.###.#.#####.#.#.#.#.#.#########.#.###.#####.#.###.#.###.#.#.#######.#.#.###.#.#.#.###.#
#.................#.#.....#...#.#.#.......#...#.....#.#.#...#...#.#.#...#.#.........#...#.#.......#...#.#...#...#.#...........#...#.....#.#.#
#.#.###.#.#.###.#.#.#.#####.###.#.#.#####.#.#.###.###.#.#####.#.#.#.#######.#######.###.#.###.#######.#.###.###.#.#.#######.###.#####.###.#.#
#.#.....#.#...#.#.#.#.#.......#...#.......#.#.#...............#...#.......#.#.....#.#...#...........#.#...#...#.....#...........#.#.........#
#.#####.#.###.#.#.#.#.#.#####.#########.#.#.#.#.###.#######.#####.#######.#.#####.#.#.###.#.#########.#######.#.#.###.#####.#.###.#.#.#######
#.....#.#.#.#.#.#.#...#...#.........#...#.#.#.#.#.#.........#...#.....#.#.#.#...#.#.#...#...........#.#.......#.#.#...#.....#.......#.#.....#
#.#.###.#.#.#.###.#.#.#####.#########.#.#.#.###.#.###.#######.#.#####.#.#.#.#.#.#.#.###.###########.#.#.#######.#.#.#####.###.#######.#.###.#
#.#...#...#...#...#...#...#...#.....#...#.#...........#.......#.#.....#.#.#...#...#.#...#.............#...#.#...#.#.....#.....#...#.......#.#
#.###.#.###.###.#####.#.#.###.#.###.#.###.#.#########.#.###.#####.#####.#.###.#.#.#.#.###.#########.#.#.#.#.#.#########.#.#####.###.#######.#
#.#.......#.#...#...#.#.#.....#.#.#.#.#...#.#...............#.....#...#.#...........#.....#...#...#.#.#.#.#.............#.#...........#...#.#
#.#.#######.#.#.#.###.#.#.#####.#.#.#.#.#####.#.#############.#####.#.#.#####.###.#.#####.#.#.#.#.#.#.#.#.###############.#############.#.#.#
#.#.....#...#.#.#...#.#.#.#...........#.......#.#.......#...#.#.....#.#...#...#...#.......#.#...#...#.#.#...#.....#.#...#...#.....#...#.#.#.#
#######.#.#.#.#.###.#.#.###.#########.#########.#.#####.#.#.#.#.###.#####.#.#.#.#####.#.#.#.#########.#.###.#.#.#.#.#.#.###.#.###.#.#.#.#.#.#
#.......#.#...#...#...#...#.#.......#.#.......#.#.....#.#.....#...#...#.....#.#.#...#.#.......#.......#.....#.#.#.....#...#...#.#...#...#.#.#
#.#####.#.#.#####.#.###.#.#.#.#####.###.#####.#.#####.#.#.#####.#####.#.###.#.###.#.###########.#######.#.#####.#####.###.#####.#########.#.#
#.#...#.#.........#.#...#...#...#.#.#...#...#.#.#.....#.#.#.#...#...#.#.#...#.#...#.....#.......#.....#.#.#...#.......#.#...#.........#.#...#
#.#.#.#.###.#######.#########.#.#.#.#.#.#.###.#.#.###.#.#.#.#.###.#.#.#.#.###.#.#######.#.#####.#.###.#.#.#.#.#.#######.#.###.###.###.#.###.#
#...#.#...........#.....#...#.#.#.....#...#...#.#.#...#...#.#.#.#.#...#...#...#.#.......#.#.....#...#.#.#...#.#.#.......#.....#.#...#.#...#.#
#.###.#####.#####.#.###.#.#.#.#.#########.#.###.#.#.###.###.#.#.#.###.#####.###.###.#####.###.#.#.#.#.#######.#.###.###########.###.#.#.#.#.#
#.#...#.#...#...#...#.#.#.#.#.#.....#.....#.#...#.#.....#...#...#.#.......#.#.....#.....#.#...#.#.#.#.....#...#...#.........#...#...#...#.#.#
###.###.#.#.#.#.###.#.#.#.#.###.###.#.#####.#.#.#.###.###.#.#.#.#.#######.#.###.#.#####.#.#.#####.#.#####.#.#####.#####.###.#.#.#.#########.#
#...#.....#...#.....#.#...#...#...#.......#.#...#...#...#.#.#.....#...#...#...#.#.#...#...#.#...#.#.#.......#...........#.....#.#.....#.....#
#.###.#####.#########.#######.###.#.#.###.#.###.###.###.#.#.#.###.#.#.###.###.#.#.#.#.#####.#.#.#.#.#################################.#.#####
#.#.....#...........#.......#.#...#.#.#.#...#.....#...#.#.#.#...#...#...#.....#...#.#...#.....#.#.#.#.....................#.........#.......#
#.#####.#.#.#######.#.#.#####.###.#.#.#.#####.#.#####.#.#.#.###.#######.###.#.###.#.#####.#####.#.#.#.#####.#############.#.###.###.#########
#.#...#...#...........#.....#...#.#.#.#.......#.......#...#...#.#.#.....#...#.....#...#.....#...#.#.......#.....#.......#.#.................#
#.#.#.#################.###.###.#.#.#.#.#####.#.#######.###.###.#.#.#########.#####.#.#.#####.###.#####.#.#####.#.###.#.#.###.#.#####.###.#.#
#...#.........#.........#.#...#.#.#.....#.....#...#.......#.#...#.#.................#.#...#...#...#...#.#.....#.#.#...#.....#.#.......#.....#
#######.#####.#.#########.###.#.#.#.#########.###.#.#######.#.###.###.#.#############.###.#.###.###.###.#####.#.###.###.###.#.#########.#####
#.....#.#.....#.#.........#.#...#.#.....#...#...#.#.#...#...#.......#.#.#.#.........#.....#.....#.....#.#.....#.....#...#...#.........#.....#
#.###.###.###.#.#######.#.#.#########.#.#.#.#.#.#.#.###.#.###.#####.#.#.#.#.#.#####.#################.#.###.#####.###.#.#######.#.#########.#
#...#.....#.#.#...............#.....#.#...#.#...#.#...#.#.#.......#.#...#...#.#...#.....#.#.........#.#...#.....#.#.....#.....#...#.....#...#
###.#######.#.###############.###.#.#.#####.#####.###.#.#.#.#####.#.#####.###.#.#.#####.#.#.###.###.#.###.###.#.#.#.###.#.###.#.###.###.#.#.#
#...#.....#...#.....#.......#.....#.#.#.....#...#...#...#.......#...#.......#.#.......#.#.....#...#.....#.#...#.#.#...#.#...#...#...#.....#.#
#.###.#.###.###.#.#.###.###########.###.#####.#.###.###.#######.#########.###.#######.#.#########.###.###.#.###.#####.###.#.#####.#######.#.#
#...#.#.....#...#...#...#.........#...........#.....#.#.#.......#.......#.#...#.....#.........#...#...#...#...#.......#...#.....#.......#...#
###.#.#########.#.###.#.#.###.#.#.###.###.###########.#.#.#.###.#.#####.###.#.#.###.#.###.###.#.###.###.#####.###.#####.#####.#########.#.###
#...#.......#...#.....#.#...#...#...#.#...#...#.......#.#.#.#.....#...#.....#...#...#.#.....#...#.#...#.#...#...#.#...#.#...#.....#.....#.#.#
#.#########.#.#.#####.###.#######.###.#.###.#.#.#.#####.#.#.#######.#.#######.###.###.#.###.#####.###.#.#.#.###.#.#.#.#.#.#.###.#.#.#####.#.#
#.........#...#.#.....#...#.....#.....#.#...#...#.#.......#.#.......#.......#.#.....#.#...#...#.#.....#...#.#...#.#.#.#.#.#.................#
#.#.#.#.#.#######.###.#.###.###.###.###.###.#.#####.#####.#.#.#########.###.#.#####.#.###.#.#.#.#.#########.#.#.#.#.#.#.#.#######.#####.###.#
#...#.#.#...........#.#.#...#.#...#...#.#...#.#.....#.....#...#...#...#...#.#.....#.#.....#...#...#...#.....#.#.#.#.#...#.....#...#.........#
#.###.#.#############.#.#.###.###.#####.#.#####.#####.#.#.#####.#.#.#.#####.#####.#.###.#.#.###.###.#.#.#####.###.#.#########.#####.#####.###
#...#.#.#.....#.#.....#.#.#.....#.#.....#.#.....#.....#.#.#...#.#.#.#.........#...#.#...#.#.#...#...#.#.#...#.....#...#.....#...............#
###.#.#.#.#.#.#.#.###.#.#.#####.#.#.#####.#.#####.###.#.#.#.#.#.###.#####.#####.###.#.###.#.#####.###.#.#.#.#.#######.###.#.#.###.#.#.#.###.#
#.#.#...#.#.#.#.#...#.#.#.......#...#.....#...#.....#.#.#.#.#...#...#...#.#.....#.#.....#.#.#...#...#.#...#.........#.....#.#.#...#.#...#...#
#.#.#######.#.#.###.#.#.#######.#####.#.#####.#.#.#.#.#.#.#.###.#.#####.#.#.#####.#.###.#.#.#.#.###.#.#.#.#################.###.#.#.###.#.#.#
#.#.#.......#.#.#...#.#.#...#...#.#...#.....#.#.#.#...#.#...#...#.....#...#.#...........#.#.#.#.#...#.#.#.................#.....#.#...#.#.#.#
#.#.###.#####.#.#.#####.#.###.###.#.#######.#.###.#####.#########.###.#.###.#####.###.###.#.#.#.#.###.#############.#####.###.#######.#.#.#.#
#.#.....#...#.#.#.......#.#...#.....#...#...#.........#...#.....#.#...#...#...#.....#.....#...#.#.#.........#.....#.....#.....#...#...#.#.#.#
#.#######.###.#.#########.#.#####.#####.#.#########.#####.#.###.#.#.#########.#.###.#.#########.#.###.#####.#.###.###.###.#####.#.#.###.#.#.#
#.........#...#.......#...#.....#.......#.........#.....#.....#.#.#...#...#...#...#...........#.#.....#...#.#.#...#...#...#.....#.#.#...#.#.#
#.#####.###.###.###.#.#.#######.#######.###.#####.#####.#####.#.#####.#.#.#.#####.#######.#####.#####.#.#.#.#.#.#######.#.#.#####.#.###.#.#.#
#...#.#...#.#...#...#.#.......#.#.#.....#...#...#.....#.......#.#...#.#.#.#.....#.#.....#.#...#.......#.#.#...#.#.......#...#.....#...#...#.#
###.#.###.#.#.#.#.###.###.###.#.#.#.#.###.###.#.#####.###.###.#.#.#.#.#.#.#.###.#.#.#.###.#.#.#########.#######.#.#.#########.#####.#.#######
#.....#...#.#...#.#.#.....#...#.#...#...#.....#.....#.....#.....#.#...#.#.#...#.#.#.#.....#.#.......#.........#.#.#.#.#.....#.....#.#.......#
#######.###.#.###.#.###.#####.#.#.###.#.###########.#######.###.#.#####.#.#####.#.###.#####.#######.#.#####.#.#.###.#.#.#.#######.#.#######.#
#.....#.#...#...#.#.....#...#.#.#.#...#.....#...#...#...#...#.......#...#.......#...#.#.#...#.........#...#.#.#.....#.#.#.....#...#.#.#...#.#
#.###.#.#.#####.#.#.#####.#.###.#.#######.#.###.#.###.#.#.#########.#.#.#########.#.#.#.#.#.#####.#####.###.#########.#.#####.#.###.#.#.#.#.#
#.#.....#.....#.#.#...#.....#...#.........#.#...#...#.#.......#.....#.#.#.......#.#.#...#.#...............#.......#...#.#.#...#.#.....#.#.#.#
#.###########.#.#.###.#.###.#.#############.#.#.###.#.#######.#.###.#.#.#.#####.###.###.#.###.#.#####.###.#######.#.#.#.#.#.###.#######.#.#.#
#...#.......#.#.#.#.#.#.#.#...#.........#...#.#.#.#...#...#.....#.#.#.#.#.#...#...#.#...#.....#.....#...#...#...#...#.#...#...#.......#.#.#.#
###.#.###.###.#.#.#.#.#.#.#####.###.###.#.###.#.#.#####.#.#######.#.#.###.#.#####.#.#.#########.###.###.#.#.#.#.#####.#.#.###.#######.#.#.#.#
#...#...#.....#.#.#.#.#.#.........#.............#.#.....#.......#.#.#.....#.#.....#.#.......#.#.#.#.....#.#.#.#.....................#...#.#.#
#.#####.#######.#.#.#.#.#######.#.#.###########.#.#.###########.#.#.#######.#.#####.#######.#.#.#.#######.#.###.#.#.###.###.###.#########.#.#
#.#...#.......#.#.#...#.......#.................#.#...#.........#.#.......#.#.#...#.#.........#...#.......#...#...#...........#.#.......#.#.#
#.#.#.#####.#.#.#.###########.#.#.#.#.#.#.#.#####.###.#.#########.#######.#.#.#.#.#.#.###########.#####.#####.#####.#.#.#####.#.#.#####.#.#.#
#...#.......#.#.#...............#.#.#...#.#.........#.#...#.....#.......#...#.#.#...#...................#.#...#.........................#.#.#
#.#.###.#.#.#.#.#####.###.#######.#.#####.#######.###.###.#.###.#.#.#######.#.#.#######.#.#####.#.#####.#.#.###.#.#####.###.###.#####.#.#.#.#
#...#...#.#...#.#.....#...#.......#.....#.#.....#.#.....#.#...#.#.#...#...#.#.#.#.......#.....#.....#.....#.....#...............#.....#...#.#
###.#.#####.###.#.###.#.###.#.#####.#.###.#.###.#.#.###.#.#.#.#.###.#.#.#.#.#.#.#############.###.#.#.#.#############.###.#.#.###.#########.#
#.#.#.....#...#.#.#.#.#.#...#.#.#...#.#...#...#.#.#...#.#.#.#.#...#.#...#...#.#.....#.......#.#...#...#.......#.....#...#.#.#...#.....#.....#
#.#.#####.#.#.###.#.#.#.#####.#.#.###.#.#####.#.#####.#.#.###.###.###########.#.###.#.###.###.###.#####.###.###.#.#.###.#.#.###.#####.#####.#
#S......#.........#...#.......#.....#.........#.......#.......#...............#...#.....#.................#.......#.......#...#.............#
#############################################################################################################################################"""

    answer = AocDay16(data,silver_tests,gold_tests,argv)

    print(answer)
