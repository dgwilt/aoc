data = """#.###########################################################################################################################################
#.#...###...#.....#...#.....#.....#.......###...#.....#...................###.....#...###...#.......#...#...#.....###...###...#####.........#
#.#.#.###.#.#.###.#.#.#.###.#.###.#.#####.###.#.#.###.#.#################.###.###.#.#.###.#.#.#####.#.#.#.#.#.###.###.#.###.#.#####.#######.#
#.#.#...#.#.#.#...#.#...#...#...#...#...#...#.#.#.#...#.........#...#...#...#...#.#.#.###.#.#.#.....#.#.#.#.#.#...#...#.#...#...###.#.......#
#.#.###.#.#.#.#.###.#####.#####.#####.#.###.#.#.#.#.###########.#.#.#.#.###.###.#.#.#.###.#.#.#.#####.#.#.#.#.#.###.###.#.#####.###.#.#######
#.#.#...#.#.#.#.###...#...#.>.>.#.....#.....#.#.#.#.###...#...#...#...#...#...#.#.#.#.>.>.#.#.#...###.#.#.#...#...#...#.#.....#...#.#...#...#
#.#.#.###.#.#.#.#####.#.###.#v###.###########.#.#.#.###.#.#.#.###########.###.#.#.#.###v###.#.###.###.#.#.#######.###.#.#####.###.#.###.#.#.#
#.#.#.....#.#.#...#...#.....#...#.#.....#.....#...#...#.#.#.#.#...........###...#...###...#.#.#...#...#.#...#...#.###.#.#...#.#...#.#...#.#.#
#.#.#######.#.###.#.###########.#.#.###.#.###########.#.#.#.#.#.#########################.#.#.#.###.###.###.#.#.#.###.#.#.#.#.#.###.#.###.#.#
#.#.......#...#...#.........#...#...#...#.#.....#.....#.#.#.#.#...........#.....#.........#...#...#...#.###...#.#.#...#.#.#.#.#.....#.#...#.#
#.#######.#####.###########.#.#######.###.#.###.#.#####.#.#.#.###########.#.###.#.###############.###.#.#######.#.#.###.#.#.#.#######.#.###.#
#.#.......#.....#####...#...#.......#...#.#...#...#...#.#...#.#.....#...#...#...#...............#...#.#.>.>.#...#.#...#.#.#...#.....#...#...#
#.#.#######.#########.#.#.#########.###.#.###.#####.#.#.#####.#.###.#.#.#####.#################.###.#.###v#.#.###.###.#.#.#####.###.#####.###
#.#.......#.......#...#.#.....#.....#...#...#...###.#...#.....#...#.#.#.#.....#...#...#.........#...#.#...#.#...#.#...#...#.....###.....#...#
#.#######.#######.#.###.#####.#.#####.#####.###.###.#####.#######.#.#.#.#.#####.#.#.#.#.#########.###.#.###.###.#.#.#######.###########.###.#
#...#...#.#.......#...#...#...#...###.....#...#...#.....#.#.......#...#.#...#...#...#...#.......#.....#...#.#...#...#...###...........#.#...#
###.#.#.#.#.#########.###.#.#####.#######.###.###.#####.#.#.###########.###.#.###########.#####.#########.#.#.#######.#.#############.#.#.###
#...#.#...#.........#...#.#...###...#...#.....###...###.#.#...........#.#...#...#...#...#...#...#.......#.#...#.......#.......#...#...#.#...#
#.###.#############v###.#.###.#####.#.#.###########.###.#.###########.#.#.#####.#.#.#.#.###.#.###.#####.#.#####.#############.#.#.#.###.###.#
#.....###...#.....#.>.#.#.#...#...#...#.......#####...#.#...>.>...#...#.#.###...#.#...#...#.#...#.....#.#...###.#...#.......#.#.#...#...#...#
#########.#.#.###.#v#.#.#.#.###.#.###########.#######.#.#####v###.#.###.#.###.###.#######.#.###.#####.#.###.###.#.#.#.#####.#.#.#####.###.###
#.........#.#...#.#.#...#...#...#.............#.......#.#.....###...###.#...#...#.#...#...#...#.......#...#...#...#...#.....#...#...#...#...#
#.#########.###.#.#.#########.#################.#######.#.#############.###.###.#.#.#.#.#####.###########.###.#########.#########.#.###.###.#
#.........#.....#.#.....#...#...............###.........#.............#.#...###...#.#.#.....#...#.....###.....###...#...#.........#...#.#...#
#########.#######.#####.#.#.###############.#########################.#.#.#########.#.#####.###.#.###.###########.#.#.###.###########.#.#.###
#.........#...###.......#.#.#...............#...#...#.................#...###.......#.......###...#...#...#####...#...#...#...#.......#.#...#
#.#########.#.###########.#.#.###############.#.#.#.#.#######################.#####################.###.#.#####.#######.###.#.#.#######.###.#
#.....#.....#...###...#...#.#...............#.#.#.#.#...........#.....#.....#.....#.............#...#...#.....#...#.....#...#.#.......#...#.#
#####.#.#######.###.#.#.###.###############.#.#.#.#.###########.#.###.#.###.#####.#.###########.#.###.#######.###.#.#####.###.#######.###.#.#
#...#...#.......#...#.#.#...#...#...#.......#.#.#.#.#...........#...#...#...#...#...#...........#.....#.......###...#...#...#.........#...#.#
#.#.#####.#######.###.#.#.###.#.#.#.#v#######.#.#.#.#.#############.#####.###.#.#####.#################.#############.#.###.###########.###.#
#.#...###.......#...#...#...#.#.#.#.>.>.......#...#.#.......###...#.#.....#...#.#...#.......#.....#...#.....#.........#...#...........#...#.#
#.###.#########.###.#######.#.#.#.###v#############.#######.###.#.#.#.#####.###.#.#.#######.#.###.#.#.#####.#.###########.###########.###.#.#
#...#...........###.......#.#.#...###...#.........#.#...###.#...#.#.#.#...#...#.#.#.###.....#...#.#.#.#.....#...........#.............###.#.#
###.#####################.#.#.#########.#.#######.#.#.#.###.#.###.#.#.#.#.###.#.#.#.###v#######.#.#.#.#.###############.#################.#.#
#...#.....#.....###...#...#.#.#...###...#...#...#...#.#.....#...#...#...#.....#...#...>.>.#...#.#.#.#...###...#.....###.................#...#
#.###.###.#.###.###.#.#.###.#.#.#.###.#####.#.#.#####.#########.#######################v#.#.#.#.#.#v#######.#.#.###.###################.#####
#.....###...#...#...#.#...#...#.#.#...#.....#.#.....#.........#...#.......#.............#.#.#.#.#.>.>.#...#.#.#...#...#.................#...#
#############v###.###.###.#####.#.#.###.#####.#####.#########.###.#.#####.#.#############.#.#.#.###v#.#.#.#.#.###.###.#.#################.#.#
#...........#.>...###.....#.....#...###...#...###...###...#...###...#.....#...#.....#...#.#.#...#...#.#.#...#...#.#...#.................#.#.#
#.#########.#v#############.#############.#.#####.#####.#.#v#########.#######.#.###.#.#.#.#.#####.###.#.#######.#.#.###################.#.#.#
#.......#...#.###...###...#.........#...#...#.....#...#.#.>.>.......#...###...#.###...#.#.#.#...#...#.#.....#...#.#.###...#.............#.#.#
#######.#.###.###.#.###.#.#########.#.#.#####.#####.#.#.###v#######.###.###.###.#######.#.#.#.#.###.#.#####.#.###.#.###.#.#v#############.#.#
###...#.#.#...#...#...#.#...........#.#.....#.......#.#...#...#...#...#...#.....#.......#...#.#.....#.....#.#...#.#.#...#.>.#.....#.....#.#.#
###.#.#.#.#.###.#####.#.#############.#####.#########.###.###.#.#.###.###.#######.###########.###########.#.###.#.#.#.#####v#.###.#.###.#.#.#
#...#...#.#...#.#.....#...............#.....#.......#.#...#...#.#...#...#.#.....#.....###...#.#.........#...###.#.#.#...#...#.#...#.#...#.#.#
#.#######.###.#.#.#####################.#####.#####.#.#.###.###.###.###.#.#.###.#####.###.#.#.#.#######.#######.#.#.###.#.###.#.###.#.###.#.#
#.......#.....#.#...........#.........#.....#...#...#...#...#...#...###...#...#.......#...#.#.#.#.......#...###.#.#...#.#...#.#...#.#.....#.#
#######.#######.###########.#.#######.#####.###.#.#######.###.###.###########.#########.###.#.#.#.#######.#.###.#.###.#.###.#.###.#.#######.#
#...###.........#...#.......#.......#.......###.#.#.....#...#.###.....###.....#...###...#...#...#...#.....#...#...###...#...#.###...#.......#
#.#.#############.#.#.#############.###########.#.#.###.###.#.#######.###.#####.#.###.###.#########.#.#######.###########.###.#######.#######
#.#...............#...#.....###...#.###.....#...#...#...#...#...#.....#...#...#.#.....#...#...#####...#...###...###.....#.....#.......#...###
#.#####################.###.###.#.#v###.###.#.#######.###.#####.#.#####.###.#.#.#######.###.#.#########.#.#####v###.###.#######.#######.#.###
#.#.......#...........#...#.....#.>.>...#...#.#.......###.......#.....#.#...#...#.....#.###.#...#...#...#.#...>.>.#...#.#...#...#.....#.#.###
#.#.#####.#.#########.###.#########v#####.###.#.#####################.#.#.#######.###.#.###.###.#.#.#.###.#.###v#.###.#.#.#.#.###.###.#.#.###
#.#.#.....#.#.........###.......###.....#...#.#...###...#...#...#.....#...#.......###...#...#...#.#.#.###...###.#.#...#.#.#.#.....#...#.#.###
#.#.#.#####.#.#################.#######.###.#.###.###.#.#.#.#.#.#.#########.#############.###.###.#.#.#########.#.#.###.#.#.#######v###.#.###
#.#.#.#...#.#.#...###...#...#...#.....#...#.#...#...#.#.#.#.#.#.#.....#...#.........#...#...#.#...#.#.....#.....#...###.#.#.#...#.>.###.#...#
#.#.#.#.#.#.#.#.#.###.#.#.#.#.###.###.###.#.###.###.#.#.#.#.#.#.#####.#.#.#########.#.#.###.#.#.###.#####.#.###########.#.#.#.#.#.#v###.###.#
#...#...#...#...#.....#.#.#...###...#.....#...#.###...#.#.#.#.#.#.....#.#.#...#.....#.#.#...#.#.###.#.....#...........#.#.#.#.#...#...#.#...#
#######################.#.#########.#########.#.#######.#.#.#.#.#v#####.#.#.#.#.#####.#.#.###.#.###.#.###############.#.#.#.#.#######.#.#.###
###...#...#.............#.....#.....#.......#.#.#.......#.#.#.#.>.>.###.#.#.#.#...#...#.#...#.#...#.#...#.....#.......#.#.#.#.#.......#.#.###
###.#.#.#.#.#################.#.#####.#####.#.#.#.#######.#.#.###v#.###.#.#.#.###v#.###.###.#.###.#.###.#.###.#.#######.#.#.#.#.#######.#.###
#...#.#.#.#...#...###...#.....#.......#...#.#...#...#...#.#.#.#...#...#.#.#.#...>.>.###.#...#.#...#.#...#...#...#...###.#.#.#.#...#.....#...#
#.###.#.#.###.#.#v###.#.#.#############.#.#.#######.#.#.#.#.#.#.#####.#.#.#.#####v#####.#.###.#.###.#.#####.#####.#.###.#.#.#.###.#.#######.#
#...#.#.#.###...#.>.#.#.#...#...........#...#.......#.#.#.#.#.#.#...#.#.#.#...#...#...#...###...###...#...#.......#...#.#.#...#...#.###.....#
###.#.#.#.#######v#.#.#.###.#.###############.#######.#.#.#.#.#.#.#.#.#.#.###.#.###.#.#################.#.###########.#.#.#####.###.###.#####
#...#.#.#...###...#.#.#.#...#.#.....#...#...#.......#.#.#.#...#...#.#.#.#.#...#...#.#.#.....#.....#.....#.........#...#.#.#...#...#...#.....#
#.###.#.###.###.###.#.#.#.###.#.###.#.#.#.#.#######.#.#.#.#########.#.#.#.#.#####.#.#.#.###.#.###.#.#############.#.###.#.#.#.###.###.#####.#
#...#.#...#...#...#.#.#...###...###...#...#...#...#...#.#.#...#...#.#.#.#...#.....#.#.#...#.#.#...#.......#...###...###.#.#.#.....#...#.....#
###.#.###.###.###.#.#.#######################.#.#.#####.#.#.#.#.#.#.#.#.#####.#####.#.###.#.#.#.#########.#.#.#########.#.#.#######.###.#####
###.#.###...#.....#.#.#.......#.............#.#.#.....#...#.#...#...#...#...#.......#...#.#...#.#...#...#...#.....#...#...#.........###.....#
###.#.#####.#######.#.#.#####.#.###########.#.#.#####.#####.#############.#.###########.#.#####.#.#.#.#.#########.#.#.#####################.#
#...#.#.....#.....#...#...#...#...........#...#.#.....#...#.#...#...#...#.#.............#.....#.#.#.#.#.#...#.....#.#.#...###...#...#...#...#
#.###.#.#####.###.#######.#.#############.#####.#.#####.#.#.#.#.#.#.#.#.#.###################.#.#.#.#.#.#.#.#.#####.#.#.#.###.#.#.#.#.#.#.###
#...#.#.....#.#...#...#...#...#####.......#...#.#...###.#.#...#...#...#.#.......###...#...#...#.#.#.#.#...#...#...#.#.#.#.#...#.#.#.#.#.#...#
###.#.#####.#.#.###.#.#.#####.#####.#######.#.#.###.###.#.#############.#######.###.#.#.#.#.###.#.#.#.#########.#.#.#.#.#.#.###.#.#.#.#.###.#
#...#.....#.#.#...#.#.#.....#.#.....#...###.#.#.#...#...#.###...#.......###.....#...#.#.#.#...#.#.#.#.....#...#.#.#.#.#.#.#...#.#.#.#.#.#...#
#.#######.#.#.###.#.#.#####.#.#.#####.#.###.#.#.#.###.###.###.#.#.#########.#####.###.#.#.###.#.#.#.#####v#.#.#.#.#.#.#.#.###.#.#.#.#.#.#v###
#.#.....#.#.#.#...#.#.#...#.#.#.....#.#.#...#.#.#.###...#.....#.#.........#.....#...#.#.#.....#.#.#...#.>.>.#.#.#.#.#.#.#.#...#.#.#.#.#.>.###
#.#.###.#.#.#.#.###.#.#.#.#.#.#####v#.#.#.###.#.#.#####.#######.#########.#####.###.#.#.#######.#.###.#.#v###.#.#.#.#.#.#.#.###.#.#.#.###v###
#.#.#...#...#.#.#...#.#.#.#.#.#...>.>.#...#...#.#.#...#...#.....###.......###...###.#...#...###...###...#...#.#.#...#.#.#.#.#...#.#...#...###
#.#.#.#######.#.#.###.#.#.#.#.#.###v#######.###.#.#.#.###.#.#######v#########.#####.#####.#.###############.#.#.#####.#.#.#.#.###.#####.#####
#...#.#...#...#.#.###.#.#.#.#.#.###.....#...#...#.#.#...#.#.#.....>.>.###...#...#...#...#.#...#.........#...#.#.###...#.#...#.#...#.....#####
#####.#.#.#.###.#.###.#.#.#.#.#.#######.#.###.###.#.###.#.#.#.#####v#.###.#.###.#.###.#.#.###.#.#######.#.###.#.###.###.#####.#.###.#########
#.....#.#.#...#.#...#.#.#...#...#.....#.#...#.###.#.###.#.#...#.....#...#.#.###.#.....#...#...#.......#.#...#.#...#...#.###...#.###.........#
#.#####.#.###.#.###.#.#.#########.###.#.###.#.###.#.###.#.#####.#######.#.#.###v###########.#########.#.###.#.###.###.#.###.###.###########.#
#.#...#.#.#...#.#...#.#.#.........#...#...#.#.#...#...#...#...#.......#...#.#.>.>.......#...###.......#.#...#.#...###.#.#...#...#...###.....#
#.#.#v#.#.#.###.#.###.#.#.#########.#####.#.#.#.#####.#####.#.#######.#####.#.#v#######.#.#####.#######.#.###.#.#####.#.#.###.###.#.###.#####
#.#.#.>.#...###.#...#.#.#.........#.....#.#.#.#...#...#.....#.....#...#.....#.#.#...###...#.....#.....#...###...#####...#.#...#...#.....#...#
#.#.#v#########.###.#.#.#########.#####.#.#.#.###.#.###.#########.#.###.#####.#.#.#.#######.#####.###.###################.#.###.#########.#.#
#...#.........#.....#...###...###.....#...#...#...#.###.........#.#...#.......#.#.#...#...#.......###.............#...###...###...........#.#
#############.#############.#.#######.#########.###.###########.#.###.#########.#.###.#.#.#######################.#.#.#####################.#
#.............###...#.......#.#.......#.....###...#.#...........#.....###.......#...#...#.......#.................#.#.###.....#.............#
#.###############.#.#.#######.#.#######.###.#####.#.#.###################.#########.###########.#.#################.#.###.###.#.#############
#.#...#.........#.#.#.......#.#.........#...#...#...#...#.........#...#...#...#.....###...#.....#.#.....#...###...#.#.#...#...#.............#
#.#.#.#.#######.#.#.#######.#.###########.###.#.#######.#.#######.#.#.#.###.#.#.#######.#.#.#####.#.###.#.#.###.#.#.#.#.###.###############.#
#.#.#.#.#.......#.#.###.....#...........#.###.#.#...###...###.....#.#.#.....#...#.......#...#...#...###...#...#.#.#.#.#...#.###...#...#...#.#
#.#.#.#.#.#######.#.###.###############.#.###.#.#.#.#########.#####.#.###########.###########.#.#############.#.#.#.#.###.#.###.#.#.#.#v#.#.#
#...#...#.....#...#...#.......#.....###...#...#.#.#.#...#.....#...#.#.#...#...###.......#...#.#.#...#.........#.#.#.#...#.#.#...#.#.#.>.#...#
#############.#.#####.#######.#.###.#######.###.#.#.#.#.#.#####.#.#.#.#.#.#.#.#########.#.#.#.#.#.#.#.#########.#.#.###.#.#.#.###.#.###v#####
#...#.........#.#.....###...#...#...#...###...#.#.#.#.#.#.....#.#...#...#...#.#...#####...#.#.#.#.#.#.......#...#.#...#.#.#.#...#...###.....#
#.#.#.#########.#.#######.#.#####.###.#.#####.#.#.#.#.#.#####v#.#############.#.#.#########.#.#.#.#.#######.#.###.###.#.#.#.###.###########.#
#.#...#...###...#.#...#...#.#.....#...#.#...#.#.#.#.#.#.....>.>.#.....#...#...#.#...........#.#.#.#.###...#.#.#...#...#.#.#...#...#...#.....#
#.#####.#v###.###.#.#.#.###.#.#####.###.#.#.#.#.#.#.#.#######v###.###.#.#.#.###.#############.#.#.#.###.#.#v#.#.###.###.#.###.###.#.#.#.#####
#.......#.>...#...#.#.#...#.#.#...#...#.#.#.#.#.#.#.#.#.....#...#...#...#...###...........#...#.#.#...#.#.>.>.#...#...#...#...#...#.#...#####
#########v#####.###.#.###.#.#.#.#.###.#.#.#.#.#.#.#.#.#.###.###.###.#####################.#.###.#.###.#.###v#####.###.#####.###.###.#########
#.........#.....###.#.###.#.#...#.#...#.#.#...#...#...#...#.#...###.#...###...#...#...#...#...#.#.#...#...#...###...#...#...#...###.........#
#.#########.#######.#.###.#.#####v#.###.#.###############.#.#.#####.#.#.###.#.#.#.#.#.#v#####.#.#.#.#####.###.#####.###.#.###.#############.#
#.........#.....#...#.#...#...#.>.>.###.#.......#.........#...#.....#.#.#...#.#.#.#.#.>.>.#...#.#.#...#...###.#...#.....#...#...#...........#
#########.#####.#.###.#.#####.#.#v#####.#######.#.#############.#####.#.#.###.#.#.#.###v#.#.###.#.###.#.#####.#.#.#########.###.#.###########
#.........#...#.#...#.#.....#...#.....#.#.......#.............#.....#.#.#.#...#.#...#...#...###...#...#.#...#...#.........#.....#...........#
#.#########.#.#.###.#.#####.#########.#.#.###################.#####.#.#.#.#.###.#####.#############.###.#.#.#############.#################.#
#...#.....#.#.#.....#.....#.#.........#.#...#.................###...#.#...#...#.#...#...........#...#...#.#...............#...........#.....#
###.#.###.#.#.###########.#.#.#########.###.#.###################.###.#######.#.#.#.###########.#.###.###.#################.#########.#.#####
###...###...#.....#...###...#.........#.....#...................#...#.......#...#.#.......#.....#...#.###...#...........###.........#.#.....#
#################.#.#.###############.#########################.###.#######.#####.#######.#.#######.#.#####.#.#########.###########.#.#####.#
#...............#.#.#...#...........#.......###...#.............###.#...#...#...#.......#.#.......#.#.#.....#.#.........#...#.......#.#.....#
#.#############.#.#.###.#.#########.#######.###.#.#.###############.#.#.#.###.#.#######.#.#######.#.#.#.#####.#.#########.#.#.#######.#.#####
#.#...#...#...#...#.#...#.#.......#.....#...#...#.#.#.............#.#.#...#...#.........#.#...#...#...#.......#.........#.#.#.......#...#...#
#.#.#.#.#.#.#.#####.#.###.#.#####.#####.#.###.###.#.#.###########.#.#.#####.#############.#.#.#.#######################.#.#.#######.#####.#.#
#...#...#...#.......#...#...#####.....#...###...#.#...#...........#...#.....#...........#...#...#...#...#...#...........#.#.....###.......#.#
#######################.#############.#########.#.#####.###############.#####.#########.#########.#.#.#.#.#.#.###########.#####.###########.#
#.................#.....#.....#.......###...#...#.......#...###...#...#.......#.........#.......#.#...#...#.#.#.......###...#...#...........#
#.###############.#.#####.###.#.#########.#.#.###########.#.###.#.#.#.#########.#########.#####.#.#########.#.#.#####.#####.#.###.###########
#.#.............#.#.#...#...#.#.......#...#.#.............#...#.#.#.#.......#...#.....#...#.....#.......#...#.#.#.....#...#.#...#...........#
#.#.###########.#.#.#.#.###.#.#######.#.###.#################.#.#.#.#######.#.###.###.#.###.###########.#.###.#.#.#####.#.#.###.###########.#
#...#...........#...#.#...#.#.......#...#...###...#...........#.#.#.....#...#.....#...#...#.#.......#...#...#...#.....#.#.#.#...#...#.......#
#####.###############.###.#.#######.#####.#####.#.#.###########.#.#####.#.#########.#####.#.#.#####.#.#####.#########.#.#.#.#.###.#.#.#######
#...#.....#.......###.#...#...#...#.......#...#.#.#.....###...#.#...#...#...#...#...#...#.#.#.#.....#...#...#...#.....#.#...#...#.#.#.......#
#.#.#####.#.#####.###.#.#####.#.#.#########.#.#.#.#####v###.#.#.###.#.#####.#.#.#.###.#.#.#.#.#.#######.#.###.#.#v#####.#######.#.#.#######.#
#.#.......#...#...#...#...###...#...#.....#.#.#.#.#...>.>.#.#.#.#...#.#.....#.#.#...#.#.#.#.#.#.#...#...#.#...#.>.>.###...#.....#.#.###.....#
#.###########.#.###.#####.#########.#.###.#.#.#.#.#.#####.#.#.#.#.###.#.#####.#.###v#.#.#.#.#.#.#.#.#.###.#.#######.#####.#.#####.#.###v#####
#...#.........#...#.#.....#...#.....#...#.#.#.#.#.#...###.#.#...#.#...#.#...#.#.#.>.>.#.#.#...#.#.#.#.#...#.......#...#...#.#...#.#.#.>.#...#
###.#.###########.#.#.#####.#.#.#######.#.#.#.#.#.###.###.#.#####.#.###.#.#.#.#.#.#####.#.#####.#.#.#.#.#########.###.#.###.#.#.#.#.#.#v#.#.#
#...#.#...........#.#.#...#.#.#...#...#.#.#.#.#.#...#...#.#...#...#...#...#...#.#.###...#.....#.#.#...#...#...#...#...#...#...#...#.#.#.#.#.#
#.###.#.###########.#.#.#.#.#.###v#.#.#.#.#.#.#.###.###.#.###.#.#####.#########.#.###.#######.#.#.#######.#.#.#.###.#####.#########.#.#.#.#.#
#...#.#.....#.....#.#.#.#.#.#.#.>.>.#.#.#.#.#.#.#...#...#.#...#.#...#.....#.....#...#.#...#...#.#.#.......#.#.#.#...#.....#.........#.#.#.#.#
###.#.#####.#.###.#.#.#.#.#.#.#.#####.#.#.#.#.#.#.###.###.#.###.#.#.#####.#.#######.#.#.#.#.###.#.#.#######.#.#.#.###.#####.#########.#.#.#.#
###...#####...###...#...#...#...#####...#...#...#.....###...###...#.......#.........#...#...###...#.........#...#.....#####...........#...#.#
###########################################################################################################################################.#"""

from itertools import product

def run_silver(data):

    GRID = data.splitlines()
    XDIM = len(GRID[0])
    YDIM = len(GRID)
    G = {(x,y):cell for x,y in product(range(XDIM),range(YDIM)) if (cell := GRID[y][x]) != "#"}
    START = (1,0)
    END = (XDIM-2,YDIM-1)
    L,R,U,D = (-1,0),(1,0),(0,-1),(0,1)
    SLOPES = {U:"^",R:">",D:"v",L:"<"}

    maxpath = 0
    todo = [(0,START,set())]
    while todo:
        steps,pos,path = todo.pop()
        if pos == END:
            maxpath = max(steps,maxpath)
            continue

        x0,y0 = pos
        for dir in L,R,U,D:
            nxt = (x0 + dir[0],y0 + dir[1])
            if nxt not in path and G.get(nxt,"#") in "." + SLOPES[dir]:
                todo.append((steps+1,nxt,path | set([nxt])))

    return maxpath

from collections import deque

def run_gold(data):
    L,R,U,D = (-1,0),(1,0),(0,-1),(0,1)
    GRID = data.splitlines()
    XDIM = len(GRID[0])
    YDIM = len(GRID)
    START = (1,0)
    END = (XDIM-2,YDIM-1)
    NOT_HASH = set([(x,y) for x,y in product(range(XDIM),range(YDIM)) if GRID[y][x] != "#"])
    NODES = set([(x,y) for x,y in NOT_HASH if sum((x+dx,y+dy) in NOT_HASH for dx,dy in (U,D,L,R)) > 2]) | set([START,END])

    # Build the weighted graph by doing a BFS from each node
    G = {n:{} for n in NODES}
    for u in NODES:
        visited = set()
        queue = deque([(0,u)])
        while queue:
            steps,v = queue.popleft()
            if v in visited: continue
            visited.add(v)

            if u != v and v in NODES:
                G[u][v] = steps
                continue

            x,y = v
            for dx,dy in U,D,L,R:
                nxt = (x+dx,y+dy)
                if nxt in NOT_HASH:
                    queue.append((steps+1,nxt))

    # DFS the graph
    maxpath = 0
    stack = [(0,START,set())]
    while stack:
        steps,pos,path = stack.pop()
        if pos == END:
            maxpath = max(maxpath,steps)
            continue

        for nxt,weight in G[pos].items():
            if nxt not in path:
                stack.append((steps+weight,nxt,path | set([nxt])))

    return maxpath

print(run_silver(data))
print(run_gold(data))
