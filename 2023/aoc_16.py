data = r"""\....../.-...--.|....\../.......|......|.\......../..................|......|......................|..........
...................|........../.........-..................................../\|....|.........................
................/..../.........\.....-.................................../................./...............|..
..........|.....................\......-..-...|......-|..............|.......\.........|...........--.......|.
.\................................................/............../...|......|............-...................-
.......................|..................-..|...\...|...................................|.......-......../...
...................................../.....|....|...-................-........\....-..........................
.......--.....-.....-.-......\..../....|........\......../..|...................../...........................
.................-......\......../.....-|..............|....-........-....\......|...-.......-....../.........
...........|......-.............\.../.........\...........|.....-...../....................../.........|-.....
...................../........|...-.......-.............../\\...../..\...........................\............
........|.............................................................-....|.........-........-..../.....|....
....././...-.......|...../........../.|..\.....||.............................|............\..................
......\...|.....|..........................-......|.....-........................................./..|.......|
..|../....|..-.-............-..../|.\........................-../...\............................-\..|..-.....
.|..|....\........\.|.-....\....................\...\......../....................../..//...|.....//..-./.....
....................|.............../...|..|.|......./..........................-..............|..|.../.......
........\.................|/.......-...........|/....|.../.|.\...................-...........|.............|..
.........-..|.............\.../....|/.................|/.............\........-..................|...|........
......../........|......\...................|.....\.\.................\......\.........|..................\...
.......\...................|........./...................|.....|......./..../.|.|...-....|........../.........
...............\.|..\......./.....\....../..............\..\...../......\...-.........../\...........-........
......................-.....|......../............../......|.......\..../.............../.../.......|....../..
..............-.\/\.\....................-...\.....................\-../.....\..........\...../......./.......
......./...../....\......../........\..|.................-...................-..........-............../......
.....|..|....|...||.|..../...\......\.|........\...../......................................|..\..............
........-....\........./......|....../.../.......-...................................-|.......................
...................../...../.......................-........\.........\..|./...../.....-..........\...........
...../........\\.\\........................-..-....................\-.|.|-.........................\..........
......................./...........................-.........../.........................../........-/.../....
......-........................./...\........................\....|.../..|../..........-................./....
..-..................-............\........../.......\................................................./......
.../...................|...-.../........................|-.-......./..................-.............\.........
....\...../............../............................-..............-../..........-.....--...................
...-.......-...\...../...............................\................................................|.......
............-.......................\.-\.....\..............\............-.........\..../\...\...-..........\.
\.............|...../\...../....../..........|./...../.......................-..................-.\...........
.-..................-.....-..\..........|..............\..-......-...........//./...-..\.......-../...........
..............|..\..-...\....|.........................-..|...|/.........................-./....../\..|.....-.
...|....\.-...................|.|..................-.....\../..............\............/..........-..........
........../.....|............./............................................|..-......|\.........-........-/.|.
....|../........\..................|...\.........\./....|....-.........-...\....|............................-
-.....................|\............/............\...................-.|........-........../..................
-...|.../....-...../...../............\.................|........................|.......|-...............\-..
..\....................../.\..\.....|.............-.....-....-./......-../..................\.................
../...............|...-..\./.....-....................../................\............-........../.........|..
...|.........\......\.........-..-.|......\...............-......-..............\..........-\......\..........
..|...................\..|.....\.......\...................\............................................/.....
|..|.../.....|..../.......-..................\......../......../.........-....................................
.....\.......................-...\..\.......|........\.............\...|......./-\..........|.....-.\.........
.............................|/|.|.-............./.......|..../.........\\..-.|....|...../.......-..........|.
........|..../.............\.../\...............................................................|.............
..\.-|......|..........................|........./........-..................-......./..........|...-.......\.
/........|....\....../..........||...................|.|...|....................-.|.......\|.\................
............./.......................-..\\.|.../.....|....................\../................................
..................\..................../...........|........\.|........../........./........||.......-/.\.....
........\....-...|..|.......-...-..........................--.......\.../..\.................\................
....-....\......|..../.../......//|...........................|............./.-.|.........\/.|..-............\
-....\..../....................|..\.............\.........-.....\..|.-.\.......-.........|..\.....-...........
........../......\...........././.....-.....|................|.............-|............./...|.......\-......
.................-../............-..............................................-...\.........................
\.....|...................|.../........-..................\.....\/........-...................................
......\......................./................-.........\...-.....-.....|............./...........-..\....\..
......-..//....-........../.............\....\.\.........\...................\..\.............................
|.............-................-......................./.............................\..-.....\............/..
..........|..........................-.|............\......-........\..\.|......|.-........................../
...................|.............-......../..-...............\......../................/..........-\/|..\.....
..../|.|............................./......../.|.\.-.................-............\........|-..-.............
./............../.........-........|.|......|................-.|................/..............\..............
.........-........\..............|/............/....-..../.../.........|.........................\............
.................../.|.\.-....|................................|................./-........-..................
....................\.......\.........//..........-.../..|.....-..-................./...-.....-...............
...........|/.\..-........./...........|.-......-...................................../...................\...
......|....|...........\....-..................-...............-|............-./...............|.......|.....\
..............\...-............/...............|..../....\\../................................/...........-...
../............|..../...................-........-.................|............./..\../....\..-....\..\......
.............\...-..............|............/..........................-...................................|.
.........|...................../....-..........|........./.........|.....-......../..|..............-..../....
.....................\...................../\.................\....../........./..............\.........|.....
..................................\./.-........................|......\.................../...-......\-.......
.......|.......................|............................-.........................../.....................
......\...............-......\...........................|........................./.-........../..../....\...
.../....-|.......-........../..........-......\.............|..-.../.......\.../..../..................-......
........./.............\....-..-...\..--...|.-..-.|...-....-.....\................-/.........|.............-\.
...........|.............\.............\.....|....|.--............|...|.|.............................-/......
../.............|........|................./\..|....../.............|\............\.........\.......|.......|.
-...........-..................-........\...............................-\...................\|......|........
..................../.......-..-...............\..........\..........................................\...../|.
........|........./.......-\.......|............|............../............../......-.....|..................
...........-..........//.....|............\...\................/.........-...-./..|......................-\...
/\........./.|..............|..........|..................-|-.........|........................-..|\.\.-......
............./....../..........|//.....-.....-.../....................|.......\.......-........-...........|..
......................./..........\............./....................\.........-......-\...|..................
.......................-..../../..................-.........-........................\..............|.........
........|..../..../..-|................|.../..........|...........-................\...............-..........
.........|.......\.........................\....|..............\......\....-............................/....-
...........\..........|................................./....................../..............................
........................../.-....................\........................-......|.......|.....-../...........
.............\..-|........-.\|....\............./......\.................|.........\.-......................./
.....--...........\.............\../.....\................................./....-.........|............./.../.
............................|........................\......|/........|...................../.................
.../..|.......................................-.....|.../........................./...-.......................
.|.../../.........-....................-.................../..-......-....|................\..................
......|.....|-....\./.....\.........../.............../...............\...\....\......-.\....-...\-...-./|.../
|.|......./...-....\....\|\...\......\..\.......././.........\........-.....-.........././-....-...-\.........
.......\.|...../.../...../.........\..|./.................\..-\.........\.....|...|.......-...............-/..
............/.-.....................\......./..|................................../|........./.........|..-..|
.../..............././..\.\............|...-.|................/..-..-.........-......-.......//...............
.....\...\-...\.......................-|.........|...-|...........\.........|.....\|...\............-......./.
........|./......|\.................\....|\.................-.../........./..............\-.....-....../....-."""

# Good variable (constant) names are key to bug-free code. 4 compass directions
N,S,W,E = (0,-1),(0,1),(__,__),(__,__)

grid = data.splitlines()
xdim = len(grid[0]) # X-Dimension (width)
ydim = len(grid)    # Y-Dimension (height)

# A dictionary that tells you which direction to go if you hit a cell from a particular direction. 
# Data structure is important to allow for splitters
mirrors = {
    "\\": {E:[S], N:[W], W:[N],   S:[E]}, # Need to escape the backslash character!
    "/" : {N:[__], W:[__], S:[__], E:[__]},
    "|" : {N:[N], S:[S], E:[__,__], W:[__,__]}, # Splitter
    "-" : {W:[__], E:[__], N:[W,E], S:[W,E]}, # Splitter
    "." : {N:[__], S:[__], W:[__], E:[__]}
}

# Position and direction of a beam, as a tuple so can be added to a set.
start = ((0,0),E)

# A classic DFS algorithm - have to be able to write these in your sleep!
beams = set()
todo = [start]
while todo:
    beam = todo.___()
    if beam in beams: continue
    beams.___(beam)

    (x0,y0),dir = beam

    cell = grid[___][___]
    for nxtdir in mirrors[___][___]:
        dx,dy = nxtdir
        x = x0 + dx
        y = y0 + dy
        if __ <= x < ___ and __ <= y < ___:
            todo.___(((x,y),nxtdir))

print(len(set([p for p,_ in beams])))
