#!/usr/bin/env python3 
from itertools import product
from sys import argv
from aoc import AocDay

class AocDay13(AocDay):

    def symmetry2(grid,xdim,ydim,ignore=None):
        for c in range(1,xdim//2+1):
            if all(row[:c] == row[c:2 * c][::-1] for row in grid):
                result = (c,0)
                if not(ignore and result == ignore):
                    return result
            if all(row[-c:] == row[-2*c:-c][::-1] for row in grid):
                result = (xdim-c,0)
                if not(ignore and result == ignore):
                    return result
                
        for r in range(1,ydim//2+1):
            if all(grid[r-y-1] == grid[r+y] for y in range(r)):
                result = (0,r)
                if not(ignore and result == ignore):
                    return result
            if all(grid[-(r-y)] == grid[-(r+y+1)] for y in range(r)):
                result = (0,ydim-r)
                if not(ignore and result == ignore):
                    return result

        return 0
    
    lineval = lambda s: s[0] + 100*s[1]

    def symmetry(pattern):
        grid = pattern.splitlines()
        xdim = len(grid[0])
        ydim = len(grid)
        return AocDay13.lineval(AocDay13.symmetry2(grid,xdim,ydim))

    def run_silver(self,data):
        return sum(AocDay13.symmetry(pattern) for pattern in data.split("\n\n"))
        
    def run_gold(self,data):
        change = {"#":".",".":"#"}
        result = 0
        for pattern in data.split("\n\n"):
            smudged = pattern.splitlines()
            xdim = len(smudged[0])
            ydim = len(smudged)
            dirty_reflection = AocDay13.symmetry2(smudged,xdim,ydim)
            for r,c in product(range(ydim),range(xdim)):
                clean_reflection = AocDay13.symmetry2([row if y != r else row[:c] + change[row[c]] + row[c+1:] for y,row in enumerate(smudged)]
                                                      ,xdim,ydim,ignore=dirty_reflection)
                if clean_reflection != 0:
                    result += AocDay13.lineval(clean_reflection)
                    break
        return result
    
if __name__ == "__main__":

    silver_tests = ["""#.##..##.
..#.##.#.
##......#
##......#
..#.##.#.
..##..##.
#.#.##.#.

#...##..#
#....#..#
..##..###
#####.##.
#####.##.
..##..###
#....#..#""",""""""]

    gold_tests = ["""""",""""""]

    data = """.##..##
###..##
#..##..
#..##..
##....#
.##..##
##.##.#
###..##
.##..##
..#..#.
.#.##.#

#...#..##.#..##..
..###.#.##..#..##
.....#...#####.##
.....#...#####.##
..###.#.##..#..##
#...#..##.#..##..
.##.#.###.###..##
.###.#.#..#.#.#.#
##...#.#.....#.#.
.#...#..##.##..#.
######.#..#..##.#
#######.##.....#.
####.##.##.....#.

####.##.#######
.####..####....
####.##.#######
.###.##.###.##.
.##..##..##....
.#...##...#.##.
#..######..####
#..#....#..####
.###.##.###.##.
#.#..##.##.####
#.#.#..#.#.#..#
####....#######
.##......##.##.

#..#.###..###.#
.###..#....#..#
.###.#..##..#.#
..###........##
.###.#.#..#.#.#
.....##....##..
##..#.#.##.#.#.
##..#.#.##.#.#.
.#...##....##..
.###.#.#..#.#.#
..###........##

.##.#.#
###..##
#..#.#.
#..#...
#..#...
#.##.#.
###..##
.##.#.#
.##.#.#
###..##
#.##.#.
#..#...
#..#...
#..#.#.
###..##
.##.#.#
....#..

#.#..##
#.#.#.#
...##..
#..###.
.#..##.
.#####.
.#####.
.#..##.
#..###.
...##..
#.#.#.#
#.##.##
#.##.##

....###....###.
#..############
#..#.##....##.#
######..##..###
.##..##.##.##..
....#.#.##.#.#.
.##..##.##.##..
.##.###....####
.##...######...
#..#..#....#..#
.##....#..#....
.##.#........#.
.##.##.#..#.##.
.##..##.##.##..
#..###..##..###

########.##..#.
##....##....##.
.#.##.#..##..##
...........#..#
#######.#.###..
#.####.###....#
##....###....##
...##....#.#...
##....##.######
##....##.######
...##....#.#...
##....###....##
#.####.###....#

#.###.#..
#.###.#..
..##.#.##
#.####.#.
#####...#
#.##.##..
..##.#...
##...###.
.#....#.#
#..#...##
#..#.#.##

.#######..###
...##...##...
###..#####...
###..#####...
...##...##...
.#######..###
.#....#.##.#.

.###.##..##.###..
...#...##...#....
..#.#.####.#.#...
.#...#...##...#.#
.....#....#.....#
#.##.##..##.##.#.
...#.######.#...#
#.#..#.##.#..#.#.
....##....##....#
#######..########
##.#..####..#.##.
#..#..#..#..#..##
#..#..#..#..#..##

.#.##....##
....#....#.
.#.#.####.#
.####....##
###........
#.#..####..
#.##.####..
##.#......#
...#.####.#
...#.####.#
##.#......#
#.##.####..
#.#..####..

###.#...###
...#..##.#.
.##.#..##.#
.##.###....
..#.##..#..
#..#.#.#.##
.#.#..#..##
...#..#..##
#..#.#.#.##
..#.##..#..
.##.###....
.##.#..##.#
...#..##.#.
###.#...###
###.#...###

.##.##.
.#.#..#
.#.####
##..##.
#.#....
...#..#
.######
...#..#
#...##.
.#.####
.#.####
#.#.##.
...#..#

.......###..#.#.#
#.##.#......###.#
.####.##.#.#.##.#
.####.##..####..#
#.##.##......###.
......##..#......
.####.#.....#....
##..###.#.#...###
##..##..#.#...###

..##.##.##.
#..#.#.####
.#.#...####
.#..#.##..#
..#####....
#.####.....
##.##...##.
##.##...##.
#.####.....
..#####....
.#..#.##..#
##.#...####
#..#.#.####
..##.##.##.
#..#.###..#
###.###.##.
####.##....

#.#.###
##.....
.#..##.
.###..#
.###..#
.#..##.
##.....
#.#.###
###.###

##..#...#.###
.#.##.#...###
##.#..###..##
..........###
.#.###.....##
#...#.#.#..##
#.##.#####...
.#.##..###...
...##..##.###
##...........
#####..####..
#####..####..
#............

###.###
....###
.##..##
...####
##.####
#...#..
###.#..
..###..
...#.##
.#.#.##
..###..

#.######.##
...####....
...#..#....
.#..##..#..
##.#..#.###
#.#....#.##
#.#......##
####..#####
#.#....#.##
.#.####.#..
#.##..##.##
##..##..###
.##.##.##..

..###..###...##
...#....#....##
.#........#.###
..#.#..#.#..###
#...#..#...##..
###.#..#.###.##
##############.
#.#.#..#.#.#.##
..##.##.##.....

##....###...###
.##..##.##..###
##....##...####
##.##.###.#....
#..##..##.##.#.
.#....#.###.##.
##....###...###
##....###...###
.#....#.###.##.
#..##..#####.#.
##.##.###.#....
##....##...####
.##..##.##..###
##....###...###
..####..#...###
.######.#.##.##
.##..##...####.

.#.#...
.#.#...
#.#..##
.####..
...###.
#..##..
##.#.#.
....#.#
....#.#
##.#.#.
##.##..
...###.
.####..

..##....##.
###.#..####
##........#
####.##.###
...#....#..
####.##.###
##.######.#

..#......#....#..
.#.#....#.#..#.#.
..#.#..#.#....#.#
##.#.##.#.####.#.
...##..#........#
.#..####..#..#..#
.#.#.##.#.#..#.#.

.#.#..#...#..
##...#####.#.
...#...##.#..
..##.#.#..##.
##...#..####.
####.##.#..#.
...#.#.####..
..##.#..#..#.
#######...#.#
####..#...###
####.######.#
##..##...##.#
....#..#.##.#
....#..#.##.#
##..##...##.#
####.######.#
####..#...###

##..##.#.##.#.#
..###..######..
..#...#..##..#.
####.##.####.##
###.#..#.##.#..
..###....##....
###.#....##....
.....##########
###..###....###
####.###.##.###
..#####.#..####
##.#####.##.###
##.#..########.

##.####
###.#.#
...####
######.
#####..
###....
###...#
..###..
##..###
..###.#
####.#.
......#
......#
####.#.
..###.#
##.####
..###..

....#.##..##.#.
####..#....#..#
#..#....##....#
......#.##.#...
.##.#........#.
.##...##..##...
#..###.#..#.###
#..###..##..#.#
#..###......###
#..#.#.####.#.#
.......####....
....##......##.
.##..#.#..#.#..
#..#.#.####.#.#
.....##....##..

.#......#.####..#
#..####..#..##..#
.#.####.#..#..#..
#...##...#.#.####
##########.......
#..####..#....##.
.##.##.##.#.#.##.
#........#....##.
..#.##.#....#.##.

###.##.#....#.##.
..####.##..##.###
###..#..####..#..
..#..............
###...##....##...
..#.###..##..###.
...#.#...##...#.#
##...#.#....#.#..
###.##..####..##.
...##.#......#.##
...#.#...#....#.#
####.....##.....#
###...##.##.##...
####.####..####.#
....#####..#####.

#.##.#..#
##...#.##
##....##.
....##...
....###..
##....##.
##...#.##
#.##.#..#
#.##.#..#

.##.#......#.
#####.####.##
#..#...##...#
.##.###.####.
....#..##..#.
#.##..####..#
....###..###.
#....######..
##....#..#...
#.##.#....#.#
...#...##...#
..#.########.
..#.########.
...#...##...#
#.##.#....#.#

.#.#.#..#....
.#.#.#..#....
#.#.###.#....
#......###..#
...##..#.#..#
.##..###.#.##
.#.#.##.#.###
##..##..#.#.#
..#..######.#
#..#.####.#..
..######.#.##
..######.#.##
#..#.#.##.#..

##.###.....#.
##.#..####...
##...###.##.#
###..###..#.#
...##...#..##
...##...#..##
###..###.##.#
##...###.##.#
##.#..####...
##.###.....#.
##...#.##.#.#
..###..#.#...
##.###...#..#

..#.##....##.#...
###..######..####
..#.###..###.#...
....##.##.##.....
.###..#..#..###..
..#####..######..
######....#######
##.###....###.###
#.#.#.#..#.#.#.##
###.#.####.#.####
.##.#..##..#.##..

.#..##..##.
..#.#....#.
.....####..
#..###..###
###..#.##..
####.#..#.#
####.#..#.#

#.##.##
..##.##
..##.##
#.##.##
.#....#
#.#....
##.##.#
..###..
...###.

####.#..#.#
....######.
......##...
.##.######.
......##...
.##.#.##.#.
.##........
....######.
.##.....#..

##....###
#...#####
#.###...#
.#..#..##
....####.
...##.##.
##...#.#.
##...#.#.
...##.##.
....####.
.#..#..##
#.###...#
#...#####
##.#..###
##.#..###

#.##..##.#.#.####
..........##.....
..######..####..#
..######....#.##.
#.##..##.##.##.##
..##..##...#.....
#.##..##.###.....
###....###...#..#
#........###..##.
#...##...##.#####
....##......#####
..##..##..#..#..#
#.#.##.#.#####..#

##.##.##...###.
#.####.##..###.
..####..#......
##.##.##.#..#..
..####...#...##
........#.#.#.#
..#..#..#...##.
##.##.###..##.#
##.##.###...###
###..###.#...##
..#..#...##..#.

#...#..#....#..
.#..###..##..##
##..#..##..##..
.##.#####..####
.#..#..#....#..
.#.###..#..#..#
.###.##########
.#......#..#...
#####..#....#..
.#.#...#.##.#..
.######..##..##
#.#..##.#..#.##
........####...

##.#.#.##
....#....
######...
##.##.##.
###....#.
....##.##
##.#.....
....#..##
...######
....#####
....#..##

#.#.#.#.###.#....
##..###..##.#....
.#.#.##.###.#####
..###....###.##..
#..#.#.##..######
#.#.###..###.....
.####...######...
##..#.#.#..#.#.##
#.####.##...#.###
#.##.#.##.###..##
.##...#.##.....##
.....###.#.###...
.#.##..#....#..##
.#.##..#.#..#..##
.....###.#.###...

###...#..##
..#.#...###
#.#.##.....
...#...####
##.#...#.##
......#..##
#..#.##....
...###..#..
..#.##.##..
..#.##.##..
.#.###..#..
#..#.##....
......#..##

##.####
#..##..
..##..#
#..#...
....#.#
##.##..
#.##..#
#.#.#..
#.#.#..
#.##..#
#..##..
....#.#
#..#...
..##..#
#..##..
##.####
##.####

#.##.#####.####.#
.#..####.#......#
#..###.##...##...
.##.....####..###
##..###..########
#.##.#....#.##.#.
#.##.#....#.##.#.
##..###..########
.##.....####..###
#..###.##...##...
.#..###..#......#

.###..#.##.#.#.
#...####...##.#
...#.####..#.##
#..###...#####.
#..###...#####.
...#.####..#.##
#...####...##.#
.###..####.#.#.
#.#..#.####..##
#..#####..#..##
#..#####..#..##

#.#....#####..#
..###..##...##.
..#.###.##.....
...##...#...##.
...##...#...##.
..#.###.##.....
..###..##...##.
#.#....#####..#
.#.#......#.#..
#....##....#..#
##.#.#.#####..#

.#..###..#...#.##
###.##.#.#....#..
###.##.###....#..
.#..###..#...#.##
##..#..#.#.##....
#....#....###.#..
....#.##..###..##
.#.###.#..#..#...
.#..##.##.#.#..##

...##...#..
##.##.####.
##....##..#
..#..#.....
#.#..###...
#..##..#..#
.######..#.
##....##..#
...##.....#
...##.....#
##....##..#

#....#......#..
#.##.########.#
##..##########.
##..##.#..#.##.
.####..####..#.
#.##.#.#..#.#.#
#######.##.####
######......###
.####.#.##.#.##
.......####....
##..####..####.
.#..#.#.##.#.#.
.####.#....#.##

########...##..
#......###....#
###..##########
#########..##..
#..##..#...##..
........#..##..
.#....#.##.##.#
.#....#.##.##.#
.#....#........
...##......##..
..#..#...#.##.#
.#....#.#..##..
#.####.###.##.#
###..###..####.
##.######..##..

..##.....####..
..#.#.#..#..#..
..###.######.##
###..#.##....##
....####..##..#
##.###.########
..########..###
...#..###....##
....###.#.##.#.
##....####..###
##.#..###.##.##

.####.#.####..#..
.#.....#..#######
######.###..#..##
.##.....#..#.#.##
##...#..#.####.##
..##...#.####.###
#.#..####...###..
#.#.##..#.#...#..
..##..#.#..#.#...
#..##..#....##...
.##.....##.#.#.##
.###..###....#.##
.###..####...#.##

..#..####..#.
##.#.#..#.#..
...#..##..#..
##.#......#.#
###.##..##.##
...########..
..##..##..##.
##.###..###.#
..##..##..##.

.##..#..#.#..##..
.#.##....##.#..#.
..###......##..##
##..######.......
.#######.........
####...#..#######
...###..##...##..
....#.#...##....#
.#.##..#.####..##
##...###.##..##..
##...###.##..##..
.####..#.####..##
....#.#...##....#

#..##.####.
#..##.####.
#...#.####.
#####..##..
.#..##.##.#
...#..#..#.
.......##..
.##.#......
#...#......
##.#..#..#.
##...#....#
...########
#.##..#..#.
###..#.##.#
.....######
#..#....#..
#.#.##.##.#

##..#.#....
.####..#.##
.#.#.#..#.#
.#.#.#..#.#
.####..#.##
##..#.#....
#####......
.###..##.##
##..##.###.
#..#....#..
##.#####.##
.###...###.
..##...###.
##.#####.##
#..#....#..

..###....###.
####......###
...#..##..#..
....##..##...
..####..####.
...#..##..#..
..#.#....#.#.
###..#..#..##
..#.####.#.#.
##..#....#..#
#####.##.####
....##..##...
##...####...#
###..#..#..##
..#...##...#.

##.#...##.##..#
.#..##.##.#.##.
###.#..###.....
###.#..###.....
.#..##.##.#.##.
#..#...##.##..#
##.#####.#..##.
#.#.##..#.#....
#.#....####....
.######.#...##.
...#.##.#..####
..##....###.##.
..#..##.#######
.#..##...#.#..#
#..###.........
.##..#.#.###..#
######.##.##..#

##.###..##.######
##.##...#..##..##
#..#.....##.####.
..#.#...#.##....#
##..##.##.###..##
######..#########
.#..##....#.####.
.#....###..##..##
.....##.....#..#.
#....#....#..##..
#..#...#.........
#..#...##.###..##
#..#.#.##.###..##

..####.
##....#
##....#
..####.
#.#..#.
.#.##.#
...##..
##.##.#
#..##..
#.####.
#......
##....#
.######
..#####
##....#
###..##
#.####.

...#..##..#...###
.#..#....#..#...#
##.########.##.##
#...######...#...
##.#..##..#.##...
..#.######.#...##
####.##.#.######.
##....##....###..
##.########.##.#.
#.#.##..##.#.#.##
..#.#....#.#.....
.....####.....##.
#.#.##..##.#.###.
.#.#.#..#.#.#.##.
.#.#.#..#.#.#.##.

##....#
#.#..#.
.#.##.#
.#.##.#
..#..#.
##....#
.######

#.###..##.##.
#....#.#.....
###..#.####..
#.....#.#.###
#...#..#.#...
#.#..##....##
####.#..#....
.###.#.#.....
.###.#.#.....
####.#..#....
#.#..##....##
#...#..#.#...
#.....#.#.###
###..#.####..
#....#.#.....

..#....####..
..##...####..
#.#.##.#..#.#
#..#..#..#.#.
###.....##...
...###.####.#
##.#.#..##..#
##.#.#..##..#
...###.####.#
###.....##...
#..#..#..#.#.

.##..#.#..#..#.
#..#..##.#....#
.##...#..#.##.#
#.####.#.##..##
....#.#..#.##.#
#######.#......
....#...#.####.
....##.#.......
.......##.#..#.
####.#....#..#.
#####..#.######
####.#..#......
.##.#..#..#..#.
#..#####..####.
.##.....#......
.##.###...#..#.
....##.#...##..

##.#..#
.##....
..##..#
.#.####
##.#..#
.##....
.######
#.#.##.
###....
.##....
.##....
###....
#.#.##.
.######
.##....
#..#..#
.#.####

##......###..###.
..#....#...##...#
#.#.##.#.#....#.#
#........######..
.##....##.####.##
.#.####.#..##..#.
##..##..##....###
..........####...
...####....##....

##...##.##.##...#
###..##.##.##..##
#####.##..##.####
##.##........##.#
###.####..####.##
...##.#....#.##..
...#..######..#..
####.#..##..#.###
..##..#.##.#..###

..###.##.
.#####..#
....#####
##.#..###
#.##..##.
##.###.#.
.#..##...
.#..##...
##.###.#.
#.##..##.
##.#..###
....#####
.#####..#
..###.##.
..###.##.
.#####...
....#####

........#
#.####.##
.#....#.#
........#
...##....
...##....
........#
.#....#.#
#.####.#.
........#
..#..#...
#......##
.#....#.#
#.#..#.##
...##....

...#.##..
##.###...
#...#####
###...###
##...#...
###.#.###
.####.#..
###......
.##..#...
.##..#...
###......
.####....
###.#.###
##...#...
###...###
#...#####
##.###...

#..#....#..##.##.
#..######..##.##.
#...#..#...#.....
.#..#..#..#.##..#
.####..####.##..#
#.#.####...######
..########....##.
..#.#..#.#..#....
##..####..###.##.

.####.###
#....#...
#.##.#...
..##..###
######.#.
##..##.##
#.##.####
.####.#..
#....####
######...
..##.....

......#..#...
.##...####.##
.....#.#..###
####.#.###.#.
#..####..#.##
.##.#..#.....
##.#.###..###
.....#...##.#
#..#.##.###.#
#..###.#..#..
#..##.#.####.
####.#..#..#.
.##..#...###.
....##.##...#
.##....##..#.
....#.##.....
....#.##.....

##..##.
##..##.
.#..#..
#....#.
.####.#
#....#.
..###..

###.....#
###.....#
.##.#..##
#..#.#.##
####..#..
.##..##..
##...###.
..#.###.#
..#.###.#
##..####.
.##..##..
####..#..
#..#.#.##

#.#....#.#.......
#...#.....##.##..
#...#.....##.##..
#.#....#.#.......
#######..#.......
.#######.##..##..
.#.##.####.##..##
#####...##.......
##.####...##....#

#.#.#####
.....#...
#..###..#
#####.##.
.###.#..#
...##.##.
.##..####
#..#.....
.###.#..#
....#.##.
##...#..#
#..######
#..######

.#####.#..#.#####
#..#...####..##..
.###.#.####.#.###
..#..########..#.
##..###....###..#
##..###....###..#
..#..########..#.

...#....##.#.#.
#....#.....#.#.
###.##..##..#.#
##.#######.##..
###..#.#..####.
..###.###...#..
#.##.....#.####
#.##.....#.####
..###.###......
###..#.#..####.
##.#######.##..
###.##..##..#.#
#....#.....#.#.
...#....##.#.#.
.##..##.....##.
#####...####...
#####...####...

#.###..######
####..####...
.#.###.##..##
.......#..#..
###.#...##.##
#....##..####
.#.....###.##
#....#..#....
#....##.#....

..#.##.....
.####.####.
.#.#.#.###.
..###.###.#
..###.###.#
.###.#.###.
.####.####.
..#.##.....
##..##..###
#.#........
####..####.
####..####.
#.#........

......#..
######...
.#..#..##
#....####
.#####.##
#.##.##..
#....##..
.#..#....
..##..###
.#..#..##
#....#.##
#######..
..##...##

..#..#..#..
...##....##
####.####.#
..###....##
##..#.####.
##..##..##.
###.#....#.
##...####..
####..##..#
##.###..###
..#..####..

##.###....##.#..#
##.###....##.#..#
#.....###..##....
.#####.#..#.####.
#..#.#...#....#.#
##.#.#...#....#.#
.#####.#..#.####.

.##..##.###
.##..##.###
#..##..#.##
#..##..####
###..####..
.##..##.###
........#..
...##......
#.#..#.#..#
#.####.###.
#..##..#...
#.#..#..##.
##########.

##..######.#..#
...#.#.#.#...#.
##..##.#.#.#.##
.....###..##.#.
.....###..##.#.
##..##.#.#.#.##
...#.#.#.#...#.
##..######.#..#
##.#.##...###.#
.#.##.####.####
###.#.#.......#

.###.##
##..###
##.#...
#......
##.....
#...###
#...###
##.....
#......
##.#...
##..###
.###.##
.#.###.
.##..##
...##..
..#..##
...##..

.######
.######
.....##
###.#.#
#.####.
#...#..
#.##...
#.##..#
..##.##
...#.#.
...#.#.
..##.##
####..#

......#
......#
####.#.
.#.##.#
..##...
#.##..#
.##.###
.##..##
#.##..#

..##.##..##..
###..########
#.#####..##..
#.#####..##..
###..########
..##.##..##..
#..###.......
...#..#.#####
###........##
.#.#.#.#....#
......#..#.##

..##....#......##
..##....#......##
###.####..###.###
#.##.##.###.#.##.
......##.####...#
#.##.###...######
.####.###.#...###

###...##...####
.##...##...##.#
.#....##....#..
....######.....
.####.##.####.#
..####..####..#
..####..####...

######..#####
#...######...
#..#.####.#..
.###......###
.##.#.##.#.##
...#.####.#..
#.#.##..##.#.
#.#.##..##.#.
...#.####.#..
.##.#.##.#.##
.###......###
#..#.####.#..
#...######...
######..#####
#..####.###..
...##.##.##..
##...####...#

.##.###..#.......
..##.#..#...#..#.
####.......##..##
.##......#.##..##
..#.####.........
..#.####.........
###......#.##..##
####.......##..##
..##.#..#...#..#.
.##.###..#.......
...##...#....##..
#.##.#...####..##
##..#.##..#.#..#.
...#####..#.####.
..##..#.##.......
##.######..#.##.#
.##.##...##......

##.#........##.##
...#...#...#...##
...#...#...#...##
####........##.##
#####.#.##......#
#####.####.#..#.#
##.#..##.##..###.
##..#.....#####..
##..##...#.#.#...
....#.#.#....##.#
####.###...#....#
##.####....###.##
..##..#.#.#......"""

    answer = AocDay13(data,silver_tests,gold_tests,argv)

    print(answer)
