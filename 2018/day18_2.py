from itertools import product

data = """#.|#||..#......##.#||..||....|.#.|.#...#.|..|||.|.
.#..#||..#...##|.|##|..#|..##..#.|...|..|.|##.....
.#|..#..|||.|.|...|..##|.|...|.......|..#.|.#.|...
|....##..#|.........||#|.|.#....#.|.#.#|......#|.#
|.#.|....|.|.#..##|..|...##...|....|.|..##..|.#.#|
...|.|...|....|###.....|.##.#...#........|........
||..||.#|.|.#.|...#....#.#..|#|#.###.|.|...|...|#.
|..|..#..#|....#|...##...#.||..#..#.|.|...#...|.|#
..#...|....|..|.|##...#.#.|#..#.|...#.#..#..#.#.|.
|#.|##.#....#.|.|||#.|#...#|.|#|#.###....|..|.|...
..||#..#..#.|.#...#.#..|.|...|.##|..|...#||....|..
||.|......|.#...##|..#.|.....##|.#..#.||...|.#|.|.
#...|....|..#.....|.#....||#||..|...#||........|#.
|.|....#...#|..#.....#..|..||#..|...#..|...#|.#...
..#|.#.##||#|.#...|...|...#.#||.....#|.|.|.|#|.|..
|..|#..|#...#..|#.|.#..|.#.#|...|.......##.|..##..
##..#|.#||......#...|..#.|.|..#.#...|...........|.
.#....#.|.#...|.#..|.###...|...##........###..|#.#
#......#||#..#..|..#..#|.#.|...||##..|.#.|###.##..
|#.|#......|...#..|#.#|.|.|.##.|#.|........#....#.
#.|.#.|..#..||...|..|#.|..|#|.#|...||.|...#||#|.|.
....#|..|...|##.#...#.||.|...|..#|#.......##...#..
..#..#..|..|...|.|#..|...|#...|..#..|.||.##.###...
.#...###...|#|....#|||..##......#|..#.#|..|#|.#|..
.||.|#....###|.#..##..|###.|...|.....#..|..#......
#.......#...||##..#...#..|..#...##.|#..|.|.#|.#...
|.....#|#....#...#.#.....|#....|#|#|##|#||....|.|#
......#|..#...#.|.....|.|...|.|#.|..|#.#.#.|..#...
|####......#.|.....|.|.....#..#.....|#.#|...#..#.|
||.............|....|||..#|#...##..#|.#.#|.#.|.#.|
..|.....#|.###..#|..#..||...|..|#|..|.||...#.|....
.####..#...#|.##..|#.||.#|#........|.|#|...#..|...
#.##.....#|...|...#.|###..|#|.....#...|..|.|#|.|.#
|.|##.|..|..#|#......#|#......#....#|||#...|#.#.#.
........|.|.#.|#...#.#.......|.|.#|...|#.......|#.
...#.##...#.###|#....||.|...#......|#...#.#...|.#.
|...|#..|.||...#.||.|##....#.##|..|.||.....#||....
#||..|.|......|...|||.#.#.#....|#...|#|.|...|.#..|
#.##.#....#|.|.|#...|..|####...#...|#...|....#....
#|..|||#|....|#|....||....#..#...|||#|.....#...#..
#|.|....||.#...#|.#.|....|...|..|#|.#.#.||..||.##|
|#.|.#...#|#.|...#.|.|..||.|.|..#.#||....#|.|##|..
....##|||#.#....#.##|.#.#|#|#.##....#|.....|..|...
#.|.....|.||.|.#|.#.#|#..##|.#|.##.#.#...#||||#...
.#|..||#...#|.#...|.#|.|.###...|.#....||.|...#..||
.......#...#...##|#....#.||#.....|.#..|..||||.....
.......#|..#......|.##..##..#.|.|||.|..|.##|#|#|#.
...#............#.##...|......#.||#..|.......##||.
.##||..#|##.....|||....|.......|.#.|.|.|...|..|..|
..#.|.#..#.#....#..#.|..||....#......##.|.#..#..#."""

def repr(world):
    return "\n".join("".join(row) for row in world)

def run(data):
    world = [list(i) for i in data.splitlines()]
    xdim = len(world[0])
    ydim = len(world)
    O = "."
    T = "|"
    L = "#"
    seen = {}
    mins = 0
    last = 1000000000 - 1
    while mins <= last:
        changes = {}
        for x,y in product(range(xdim),range(ydim)):
            t = 0
            l = 0
            for ya in range(max(0,y-1),min(ydim,y+2)):
                land = world[ya][max(0,x-1):min(xdim,x+2)]
                t += land.count(T)
                l += land.count(L)

            acre = world[y][x]
            if acre is O and t >= 3:
                changes[(x,y)] = T
            elif acre is T and l >= 3:
                changes[(x,y)] = L
            elif acre is L and not(l >= 2 and t >= 1):
                changes[(x,y)] = O

        for (xc,yc),a in changes.items():
            world[yc][xc] = a

        w = repr(world)

        if False: # Show the world
            print(chr(27) + "[2J")
            print(w)

        try:
            tdelta = mins - seen[w]
            fast_forward = (last - mins) // tdelta
            mins += (fast_forward * tdelta)
        except KeyError:
            seen[w] = mins

        mins += 1

    nT = sum(row.count(T) for row in world)
    nL = sum(row.count(L) for row in world)
    return nL * nT
    
print(run(data))
