from itertools import product

data = """#.|#||..#......##.#||..||....|.#.|.#...#.|..|||.|.
.#..#||..#...##|.|##|..#|..##..#.|...|..|.|##.....
.#|..#..|||.|.|...|..##|.|...|.......|..#.|.#.|...
|....##..#|.........||#|.|.#....#.|.#.#|......#|.#
|.#.|....|.|.#..##|..|...##...|....|.|..##..|.#.#|
...|.|...|....|###.....|.##.#...#........|........
||..||.#|.|.#.|...#....#.#..|#|#.###.|.|...|...|#.
|..|..#..#|....#|...##...#.||..#..#.|.|...#...|.|#
..#...|....|..|.|##...#.#.|#..#.|...#.#..#..#.#.|.
|#.|##.#....#.|.|||#.|#...#|.|#|#.###....|..|.|...
..||#..#..#.|.#...#.#..|.|...|.##|..|...#||....|..
||.|......|.#...##|..#.|.....##|.#..#.||...|.#|.|.
#...|....|..#.....|.#....||#||..|...#||........|#.
|.|....#...#|..#.....#..|..||#..|...#..|...#|.#...
..#|.#.##||#|.#...|...|...#.#||.....#|.|.|.|#|.|..
|..|#..|#...#..|#.|.#..|.#.#|...|.......##.|..##..
##..#|.#||......#...|..#.|.|..#.#...|...........|.
.#....#.|.#...|.#..|.###...|...##........###..|#.#
#......#||#..#..|..#..#|.#.|...||##..|.#.|###.##..
|#.|#......|...#..|#.#|.|.|.##.|#.|........#....#.
#.|.#.|..#..||...|..|#.|..|#|.#|...||.|...#||#|.|.
....#|..|...|##.#...#.||.|...|..#|#.......##...#..
..#..#..|..|...|.|#..|...|#...|..#..|.||.##.###...
.#...###...|#|....#|||..##......#|..#.#|..|#|.#|..
.||.|#....###|.#..##..|###.|...|.....#..|..#......
#.......#...||##..#...#..|..#...##.|#..|.|.#|.#...
|.....#|#....#...#.#.....|#....|#|#|##|#||....|.|#
......#|..#...#.|.....|.|...|.|#.|..|#.#.#.|..#...
|####......#.|.....|.|.....#..#.....|#.#|...#..#.|
||.............|....|||..#|#...##..#|.#.#|.#.|.#.|
..|.....#|.###..#|..#..||...|..|#|..|.||...#.|....
.####..#...#|.##..|#.||.#|#........|.|#|...#..|...
#.##.....#|...|...#.|###..|#|.....#...|..|.|#|.|.#
|.|##.|..|..#|#......#|#......#....#|||#...|#.#.#.
........|.|.#.|#...#.#.......|.|.#|...|#.......|#.
...#.##...#.###|#....||.|...#......|#...#.#...|.#.
|...|#..|.||...#.||.|##....#.##|..|.||.....#||....
#||..|.|......|...|||.#.#.#....|#...|#|.|...|.#..|
#.##.#....#|.|.|#...|..|####...#...|#...|....#....
#|..|||#|....|#|....||....#..#...|||#|.....#...#..
#|.|....||.#...#|.#.|....|...|..|#|.#.#.||..||.##|
|#.|.#...#|#.|...#.|.|..||.|.|..#.#||....#|.|##|..
....##|||#.#....#.##|.#.#|#|#.##....#|.....|..|...
#.|.....|.||.|.#|.#.#|#..##|.#|.##.#.#...#||||#...
.#|..||#...#|.#...|.#|.|.###...|.#....||.|...#..||
.......#...#...##|#....#.||#.....|.#..|..||||.....
.......#|..#......|.##..##..#.|.|||.|..|.##|#|#|#.
...#............#.##...|......#.||#..|.......##||.
.##||..#|##.....|||....|.......|.#.|.|.|...|..|..|
..#.|.#..#.#....#..#.|..||....#......##.|.#..#..#."""

tests = [""".#.#...|#.
.....#|##|
.|..|...#.
..|#.....#
#.#|||#|#|
...#.||...
.|....|...
||...#|.#|
|.||||..|.
...#.|..|."""]

def run(data):
    world = [list(i) for i in data.splitlines()]
    xdim = len(world[0])
    ydim = len(world)
    O = "."
    T = "|"
    L = "#"
    for _ in range(10):
        changes = {}
        for x,y in product(range(xdim),range(ydim)):
            t = 0
            l = 0
            for ya in range(max(0,y-1),min(ydim,y+2)):
                land = world[ya][max(0,x-1):min(xdim,x+2)]
                t += land.count(T)
                l += land.count(L)

            acre = world[y][x]
            if acre is O and t >= 3:
                changes[(x,y)] = T
            elif acre is T and l >= 3:
                changes[(x,y)] = L
            elif acre is L and not(l >= 2 and t >= 1):
                changes[(x,y)] = O

        for (xc,yc),a in changes.items():
            world[yc][xc] = a

    nT = sum(row.count(T) for row in world)
    nL = sum(row.count(L) for row in world)
    return nL * nT

for test in [t for t in tests if t]:
    try: print(run(test))
    except Exception as e: print("Error:",e)
    
print(run(data))
